C:\Users\XDAD\source\repos\msx-tests\pt3-player.s1FNAME "pt3-player.rom" 3PageSize: equ 0x4000 56 org 0x40008 Include/RomHeader.s12 db "AB" 3 dw Execute 4 dw 0 6 dw 0 8 dw 0 9 dw 0, 0, 0 10 11C:\Users\XDAD\source\repos\msx-tests\pt3-player.s9 Include/MsxBios.s189BIOS_HWVER: equ 0x002d1112BIOS_CGTABL: equ 0x0004 13BIOS_VDP_DR: equ 0x0006 14BIOS_VDP_DW: equ 0x0007 1617BIOS_CHKRAM: equ 0x000018BIOS_SYNCHR: equ 0x000819BIOS_RDSLT: equ 0x000c20BIOS_CHRGTR: equ 0x001021BIOS_WRSLT: equ 0x001422BIOS_OUTDO: equ 0x001823BIOS_CALSLT: equ 0x001c24BIOS_DCOMPR: equ 0x002025BIOS_ENASLT: equ 0x002426BIOS_GETYPR: equ 0x002827BIOS_CALLF: equ 0x003028BIOS_KEYINT: equ 0x00383031BIOS_INITIO: equ 0x003b32BIOS_INIFNK: equ 0x003e3435BIOS_DISSCR: equ 0x004136BIOS_ENASCR: equ 0x004437BIOS_WRTVDP: equ 0x004738BIOS_RDVRM: equ 0x004a39BIOS_WRTVRM: equ 0x004d40BIOS_SETRD: equ 0x005041BIOS_SETWRT: equ 0x005342BIOS_FILVRM: equ 0x005643BIOS_LDIRMV: equ 0x005944BIOS_LDIRVM: equ 0x005c45BIOS_CHGMOD: equ 0x005f46BIOS_CHGCLR: equ 0x006247BIOS_NMI: equ 0x006648BIOS_CLRSPR: equ 0x006949BIOS_INITXT: equ 0x006c50BIOS_INIT32: equ 0x006f51BIOS_INIGRP: equ 0x007252BIOS_INIMLT: equ 0x007553BIOS_SETTXT: equ 0x007854BIOS_SETT32: equ 0x007b55BIOS_SETGRP: equ 0x007e56BIOS_SETMLT: equ 0x008157BIOS_CALPAT: equ 0x008458BIOS_CALATR: equ 0x008759BIOS_GSPSIZ: equ 0x008a60BIOS_GRPPRT: equ 0x008d6263BIOS_GICINI: equ 0x009064BIOS_WRTPSG: equ 0x009365BIOS_RDPSG: equ 0x009666BIOS_STRTMS: equ 0x00996869BIOS_CHSNS: equ 0x009c70BIOS_CHGET: equ 0x009f71BIOS_CHPUT: equ 0x00a272BIOS_LPTOUT: equ 0x00a573BIOS_LPTSTT: equ 0x00a874BIOS_CNVCHR: equ 0x00ab75BIOS_PINLIN: equ 0x00ae76BIOS_INLIN: equ 0x00b177BIOS_QINLIN: equ 0x00b478BIOS_BREAKX: equ 0x00b779BIOS_BEEP: equ 0x00c080BIOS_CLS: equ 0x00c381BIOS_POSIT: equ 0x00c682BIOS_FNKSB: equ 0x00c983BIOS_ERAFNK: equ 0x00cc84BIOS_DSPFNK: equ 0x00cf85BIOS_TOTEXT: equ 0x00d28788BIOS_GTSTCK: equ 0x00d589BIOS_GTTRIG: equ 0x00d890BIOS_GTPAD: equ 0x00db91BIOS_GTPDL: equ 0x00de9394BIOS_TAPION: equ 0x00e195BIOS_TAPIN: equ 0x00e496BIOS_TAPIOF: equ 0x00e797BIOS_TAPOON: equ 0x00ea98BIOS_TAPOUT: equ 0x00ed99BIOS_TAPOOF: equ 0x00f0100BIOS_STMOTR: equ 0x00f3102103BIOS_CHGCAP: equ 0x0132104BIOS_CHGSND: equ 0x0135105BIOS_RSLREG: equ 0x0138106BIOS_WSLREG: equ 0x013b107BIOS_RDVDP: equ 0x013e108BIOS_SNSMAT: equ 0x0141109BIOS_PHYDIO: equ 0x0144110BIOS_ISFLIO: equ 0x014a111BIOS_OUTDLP: equ 0x014d112BIOS_KILBUF: equ 0x0156113BIOS_CALBAS: equ 0x0159115116BIOS_SUBROM: equ 0x015c117BIOS_EXTROM: equ 0x015f118BIOS_EOL: equ 0x0168119BIOS_BIGFIL: equ 0x016b120BIOS_NSETRD: equ 0x016e121BIOS_NSTWRT: equ 0x0171122BIOS_NRDVRM: equ 0x0174123BIOS_NWRVRM: equ 0x0177125126BIOS_GRPRT: equ 0x0089127BIOS_NVBXLN: equ 0x00c9128BIOS_NVBXFL: equ 0x00cd129BIOS_CLSSUB: equ 0x0115130BIOS_VDPSTA: equ 0x0131131BIOS_SETPAG: equ 0x013d132BIOS_INIPLT: equ 0x0141133BIOS_RSTPLT: equ 0x0145134BIOS_GETPLT: equ 0x0149135BIOS_SETPLT: equ 0x014d136BIOS_PROMPT: equ 0x0181137BIOS_NEWPAD: equ 0x01ad138BIOS_CHGMDP: equ 0x01b5139BIOS_KNJPRT: equ 0x01bd140BIOS_REDCLK: equ 0x01f5141BIOS_WRTCLK: equ 0x01f9143144BIOS_RDPRIM: equ 0xf380145BIOS_WRPRIM: equ 0xf385146BIOS_CLPRIM: equ 0xf38c148149BIOS_USRTAB: equ 0xf39a150BIOS_LINL40: equ 0xf3ae151BIOS_LINL32: equ 0xf3af152BIOS_LINLEN: equ 0xf3b0153BIOS_CRTCNT: equ 0xf3b1154BIOS_CLMLST: equ 0xf3b2156157BIOS_TXTNAM: equ 0xf3b3158BIOS_TXTCOL: equ 0xf3b5159BIOS_TXTCGP: equ 0xf3b7160BIOS_TXTATR: equ 0xf3b9161BIOS_TXTPAT: equ 0xf3bb163164BIOS_T32NAM: equ 0xf3bd165BIOS_T32COL: equ 0xf3bf166BIOS_T32CGP: equ 0xf3c1167BIOS_T32ATR: equ 0xf3c3168BIOS_T32PAT: equ 0xf3c5170171BIOS_GRPNAM: equ 0xf3c7172BIOS_GRPCOL: equ 0xf3c9173BIOS_GRPCGP: equ 0xf3cb174BIOS_GRPATR: equ 0xf3cd175BIOS_GRPPAT: equ 0xf3cf177178BIOS_MLTNAM: equ 0xf3d1179BIOS_MLTCOL: equ 0xf3d3180BIOS_MLTCGP: equ 0xf3d5181BIOS_MLTATR: equ 0xf3d7182BIOS_MLTPAT: equ 0xf3d9184185BIOS_CLIKSW: equ 0xf3db186BIOS_CSRY: equ 0xf3dc187BIOS_CSRX: equ 0xf3dd188BIOS_CNSDFG: equ 0xf3de190191BIOS_RG0SAV: equ 0xf3df192BIOS_RG1SAV: equ 0xf3e0193BIOS_RG2SAV: equ 0xf3e1194BIOS_RG3SAV: equ 0xf3e2195BIOS_RG4SAV: equ 0xf3e3196BIOS_RG5SAV: equ 0xf3e4197BIOS_RG6SAV: equ 0xf3e5198BIOS_RG7SAV: equ 0xf3e6199BIOS_RG8SAV: equ 0xffe7200BIOS_RG9SAV: equ 0xffe8201BIOS_STATFL: equ 0xf3e7202BIOS_TRGFLG: equ 0xf3e8203BIOS_FORCLR: equ 0xf3e9204BIOS_BAKCLR: equ 0xf3ea205BIOS_BDRCLR: equ 0xf3eb206BIOS_MAXUPD: equ 0xf3ec207BIOS_MINUPD: equ 0xf3ef208BIOS_ATRBYT: equ 0xf3f2210211BIOS_QUEUES: equ 0xf3f3212BIOS_FRCNEW: equ 0xf3f5214215BIOS_SCNCNT: equ 0xf3f6216BIOS_REPCNT: equ 0xf3f7217BIOS_PUTPNT: equ 0xf3f8218BIOS_GETPNT: equ 0xf3fa220221BIOS_CS120: equ 0xf3fc222BIOS_LOW: equ 0xf406223BIOS_HIGH: equ 0xf408224BIOS_HEADER: equ 0xf40a225BIOS_ASPCT1: equ 0xf40b226BIOS_ASPCT2: equ 0xf40d227BIOS_ENDPRG: equ 0xf40f229230BIOS_ERRFLG: equ 0xf414231BIOS_LPTPOS: equ 0xf415232BIOS_PRTFLG: equ 0xf416233BIOS_NTMSXP: equ 0xf417234BIOS_RAWPRT: equ 0xf418235BIOS_VLZADR: equ 0xf419236BIOS_VLZDAT: equ 0xf41b237BIOS_CURLIN: equ 0xf41c238BIOS_KBUF: equ 0xf41f239BIOS_BUFMIN: equ 0xf55d240BIOS_BUF: equ 0xf55e241BIOS_ENDBUF: equ 0xf660242BIOS_TTYPOS: equ 0xf661243BIOS_DIMFLG: equ 0xf662244BIOS_VALTYP: equ 0xf663245BIOS_DORES: equ 0xf664246BIOS_DONUM: equ 0xf665247BIOS_CONTXT: equ 0xf666248BIOS_CONSAV: equ 0xf668249BIOS_CONTYP: equ 0xf669250BIOS_CONLO: equ 0xf66a251BIOS_MEMSIZ: equ 0xf672252BIOS_STKTOP: equ 0xf674253BIOS_TXTTAB: equ 0xf676254BIOS_TEMPPT: equ 0xf768255BIOS_TEMPST: equ 0xf67a256BIOS_DSCTMP: equ 0xf698257BIOS_FRETOP: equ 0xf69b258BIOS_TEMP3: equ 0xf69d259BIOS_TEMP8: equ 0xf69f260BIOS_ENDFOR: equ 0xf6a1261BIOS_SUBFLG: equ 0xf6a5262BIOS_FLGINP: equ 0xf6a6263BIOS_TEMP: equ 0xf6a7264BIOS_PTRFLG: equ 0xf6a9265BIOS_AUTFLG: equ 0xf6aa266BIOS_AUTLIN: equ 0xf6ab267BIOS_AUTINC: equ 0xf6ad268BIOS_SAVTXT: equ 0xf6af269BIOS_ERRLIN: equ 0xf6b3270BIOS_DOT: equ 0xf6b5271BIOS_ERRTXT: equ 0xf6b7272BIOS_ONELIN: equ 0xf6b9273BIOS_ONEFLG: equ 0xf6bb274BIOS_TEMP2: equ 0xf6bc275BIOS_OLDLIN: equ 0xf6be276BIOS_OLDTXT: equ 0xf6c0277BIOS_VARTAB: equ 0xf6c2278BIOS_ARYTAB: equ 0xf6c4279BIOS_STREND: equ 0xf6c6280BIOS_DATPTR: equ 0xf6c8281BIOS_DEFTBL: equ 0xf6ca282BIOS_PRMSTK: equ 0xf6e4283BIOS_PRMLEN: equ 0xf6e6284BIOS_PARM1: equ 0xf6e8285BIOS_PRMPRV: equ 0xf74c286BIOS_PRMLN2: equ 0xf74e287BIOS_PARM2: equ 0xf750288BIOS_PRMFLG: equ 0xf7b4289BIOS_ARYTA2: equ 0xf7b5290BIOS_NOFUNS: equ 0xf7b7291BIOS_TEMP9: equ 0xf7b8292BIOS_FUNACT: equ 0xf7ba293BIOS_SWPTMP: equ 0xf7bc294BIOS_TRCFLG: equ 0xf7c4296297BIOS_FBUFFR: equ 0xf7c5298BIOS_DECTMP: equ 0xf7f0299BIOS_DECTM2: equ 0xf7f2300BIOS_DECCNT: equ 0xf7f4301BIOS_DAC: equ 0xf7f6302BIOS_HOLD8: equ 0xf806303BIOS_HOLD2: equ 0xf836304BIOS_HOLD: equ 0xf83e305BIOS_ARG: equ 0xf847306BIOS_RNDX: equ 0xf857308309BIOS_USRDATA: equ 0xf7f8311312BIOS_MAXFIL: equ 0xf85f313BIOS_FILTAB: equ 0xf860314BIOS_NULBUF: equ 0xf862315BIOS_PTRFIL: equ 0xf864316BIOS_RUNFLG: equ 0xf866317BIOS_FILNAM: equ 0xf866318BIOS_FILNM2: equ 0xf871319BIOS_NLONLY: equ 0xf87c320BIOS_SAVEND: equ 0xf87d321BIOS_FNKSTR: equ 0xf87f322BIOS_CGPNT: equ 0xf91f323BIOS_NAMBAS: equ 0xf922324BIOS_CGPBAS: equ 0xf924325BIOS_PATBAS: equ 0xf926326BIOS_ATRBAS: equ 0xf928327BIOS_CLOC: equ 0xf92a328BIOS_CMASK: equ 0xf92c329BIOS_MINDEL: equ 0xf92d330BIOS_MAXDEL: equ 0xf92f332333BIOS_ASPECT: equ 0xf931334BIOS_CENCNT: equ 0xf933335BIOS_CLINEF: equ 0xf935336BIOS_CNPNTS: equ 0xf936337BIOS_CPLOTF: equ 0xf938338BIOS_CPCNT: equ 0xf939339BIOS_CPNCNT8: equ 0xf93b340BIOS_CPCSUM: equ 0xf93d341BIOS_CSTCNT: equ 0xf93f342BIOS_CSCLXY: equ 0xf941343BIOS_CSAVEA: equ 0xf942344BIOS_CSAVEM: equ 0xf944345BIOS_CXOFF: equ 0xf945346BIOS_CYOFF: equ 0xf947348349BIOS_LOHMSK: equ 0xf949350BIOS_LOHDIR: equ 0xf94a351BIOS_LOHADR: equ 0xf94b352BIOS_LOHCNT: equ 0xf94d353BIOS_SKPCNT: equ 0xf94f354BIOS_MIVCNT: equ 0xf951355BIOS_PDIREC: equ 0xf953356BIOS_LFPROG: equ 0xf954357BIOS_RTPROG: equ 0xf955359360BIOS_MCLTAB: equ 0xf956361BIOS_MCLFLG: equ 0xf958362BIOS_QUETAB: equ 0xf959363BIOS_QUEBAK: equ 0xf971364BIOS_VOICAQ: equ 0xf975365BIOS_VOICBQ: equ 0xf9f5366BIOS_VOICCQ: equ 0xfa75368369BIOS_DPPAGE: equ 0xfaf5370BIOS_ACPAGE: equ 0xfaf6371BIOS_AVCSAV: equ 0xfaf7372BIOS_EXBRSA: equ 0xfaf8373BIOS_CHRCNT: equ 0xfaf9374BIOS_ROMA: equ 0xfafa375BIOS_MODE: equ 0xfafc376BIOS_NORUSE: equ 0xfafd377BIOS_XSAVE: equ 0xfafe378BIOS_YSAVE: equ 0xfb00379BIOS_LOGOPR: equ 0xfb02381382BIOS_RSTMP: equ 0xfb03383BIOS_TOCNT: equ 0xfb03384BIOS_RSFCB: equ 0xfb04385BIOS_RSIQLN: equ 0xfb06386BIOS_MEXBIH: equ 0xfb07387BIOS_OLDSTT: equ 0xfb0c388BIOS_OLDINT: equ 0xfb12389BIOS_DEVNUM: equ 0xfb17390BIOS_DATCNT: equ 0xfb18391BIOS_ERRORS: equ 0xfb1b392BIOS_FLAGS: equ 0xfb1c393BIOS_ESTBLS: equ 0xfb1d394BIOS_COMMSK: equ 0xfb1e395BIOS_LSTCOM: equ 0xfb1f396BIOS_LSTMOD: equ 0xfb20398399BIOS_PRSCNT: equ 0xfb35400BIOS_SAVSP: equ 0xfb36401BIOS_VOICEN: equ 0xfb38402BIOS_SAVVOL: equ 0xfb39403BIOS_MCLLEN: equ 0xfb3b404BIOS_MCLPTR: equ 0xfb3c405BIOS_QUEUEN: equ 0xfb3e406BIOS_MUSICF: equ 0xfc3f407BIOS_PLYCNT: equ 0xfb40409410BIOS_VCBA: equ 0xfb41411BIOS_VCBB: equ 0xfb66412BIOS_VCBC: equ 0xfb8b414415BIOS_ENSTOP: equ 0xfbb0416BIOS_BASROM: equ 0xfbb1417BIOS_LINTTB: equ 0xfbb2418BIOS_FSTPOS: equ 0xfbca419BIOS_CODSAV: equ 0xfbcc420BIOS_FNKSW1: equ 0xfbcd421BIOS_FNKFLG: equ 0xfbce422BIOS_ONGSBF: equ 0xfbd8423BIOS_CLIKFL: equ 0xfbd9424BIOS_OLDKEY: equ 0xfbda425BIOS_NEWKEY: equ 0xfbe5426BIOS_KEYBUF: equ 0xfbf0427BIOS_LINWRK: equ 0xfc18428BIOS_PATWRK: equ 0xfc40429BIOS_BOTTOM: equ 0xfc48430BIOS_HIMEM: equ 0xfc4a431BIOS_TRAPTBL: equ 0xfc4c432BIOS_RTYCNT: equ 0xfc9a433BIOS_INTFLG: equ 0xfc9b434BIOS_PADY: equ 0xfc9c435BIOS_PADX: equ 0xfc9d436BIOS_JIFFY: equ 0xfc9e437BIOS_INTVAL: equ 0xfca0438BIOS_INTCNT: equ 0xfca2439BIOS_LOWLIM: equ 0xfca4440BIOS_WINWID: equ 0xfca5441BIOS_GRPHED: equ 0xfca6442BIOS_ESCCNT: equ 0xfca7443BIOS_INSFLG: equ 0xfca8444BIOS_CSRSW: equ 0xfca9445BIOS_CSTYLE: equ 0xfcaa446BIOS_CAPST: equ 0xfcab447BIOS_KANAST: equ 0xfcac448BIOS_KANAMD: equ 0xfcad449BIOS_FLBMEM: equ 0xfcae450BIOS_SCRMOD: equ 0xfcaf451BIOS_OLDSCR: equ 0xfcb0452BIOS_CASPRV: equ 0xfcb1453BIOS_BRDATR: equ 0xfcb2454BIOS_GXPOS: equ 0xfcb3455BIOS_GYPOS: equ 0xfcb5456BIOS_GRPACX: equ 0xfcb7457BIOS_GRPACY: equ 0xfcb9458BIOS_DRWFLG: equ 0xfcbb459BIOS_DRWSCL: equ 0xfcbc460BIOS_DRWANG: equ 0xfcbd461BIOS_RUNBNF: equ 0xfcbe462BIOS_SAVENT: equ 0xfcbf463BIOS_ROMSLT: equ 0xfcc0464BIOS_EXPTBL: equ 0xfcc1465BIOS_SLTTBL: equ 0xfcc5466BIOS_SLTATR: equ 0xfcc9467BIOS_SLTWRK: equ 0xfd09468BIOS_PROCNM: equ 0xfd89469BIOS_DEVICE: equ 0xfd99471472BIOS_H_KEYI: equ 0xfd9a473BIOS_H_TIMI: equ 0xfd9f474BIOS_H_CHPH: equ 0xfda4475BIOS_H_DSPC: equ 0xfda9476BIOS_H_ERAC: equ 0xfdae477BIOS_H_DSPF: equ 0xfdb3478BIOS_H_ERAF: equ 0xfdb8479BIOS_H_TOTE: equ 0xfdbd480BIOS_H_CHGE: equ 0xfdc2481BIOS_H_INIP: equ 0xfdc7482BIOS_H_KEYC: equ 0xfdcc483BIOS_H_KYEA: equ 0xfdd1484BIOS_H_NMI: equ 0xfdd6485BIOS_H_PINL: equ 0xfddb486BIOS_H_QINL: equ 0xfde0487BIOS_H_INLI: equ 0xfde5488BIOS_H_ONGO: equ 0xfdea489BIOS_H_DSKO: equ 0xfdef490BIOS_H_SETS: equ 0xfdf4491BIOS_H_NAME: equ 0xfdf9492BIOS_H_KILL: equ 0xfdfe493BIOS_H_IPL: equ 0xfe03494BIOS_H_COPY: equ 0xfe08495BIOS_H_CMD: equ 0xfe0d496BIOS_H_DSKF: equ 0xfe12497BIOS_H_DSKI: equ 0xfe17498BIOS_H_ATTR: equ 0xfe1c499BIOS_H_LSET: equ 0xfe21500BIOS_H_RSET: equ 0xfe26501BIOS_H_FIEL: equ 0xfe2b502BIOS_H_MKI: equ 0xfe30503BIOS_H_MKS: equ 0xfe35504BIOS_H_MKD: equ 0xfe3a505BIOS_H_CVI: equ 0xfe3f506BIOS_H_CVS: equ 0xfe44507BIOS_H_CVD: equ 0xfe49508BIOS_H_GETP: equ 0xfe4e509BIOS_H_SETF: equ 0xfe53510BIOS_H_NOFO: equ 0xfe58511BIOS_H_NULO: equ 0xfe5d512BIOS_H_NTFL: equ 0xfe62513BIOS_H_MERG: equ 0xfe67514BIOS_H_SAVE: equ 0xfe6c515BIOS_H_BINS: equ 0xfe71516BIOS_H_BINL: equ 0xfe76517BIOS_H_FILE: equ 0xfd7b518BIOS_H_DGET: equ 0xfe80519BIOS_H_FILO: equ 0xfe85520BIOS_H_INDS: equ 0xfe8a521BIOS_H_RSLF: equ 0xfe8f522BIOS_H_SAVD: equ 0xfe94523BIOS_H_LOC: equ 0xfe99524BIOS_H_LOF: equ 0xfe9e525BIOS_H_EOF: equ 0xfea3526BIOS_H_FPOS: equ 0xfea8527BIOS_H_BAKU: equ 0xfead528BIOS_H_PARD: equ 0xfeb2529BIOS_H_NODE: equ 0xfeb7530BIOS_H_POSD: equ 0xfebc531BIOS_H_DEVN: equ 0xfec1532BIOS_H_GEND: equ 0xfec6533BIOS_H_RUNC: equ 0xfecb534BIOS_H_CLEAR: equ 0xfed0535BIOS_H_LOPD: equ 0xfed5536BIOS_H_STKE: equ 0xfeda537BIOS_H_ISFL: equ 0xfedf538BIOS_H_OUTD: equ 0xfee4539BIOS_H_CRDO: equ 0xfee9540BIOS_H_DSKC: equ 0xfeee541BIOS_H_DOGR: equ 0xfef3542BIOS_H_PRGE: equ 0xfef8543BIOS_H_ERRP: equ 0xfefd544BIOS_H_ERRF: equ 0xff02545BIOS_H_READ: equ 0xff07546BIOS_H_MAIN: equ 0xff0c547BIOS_H_DIRD: equ 0xff11548BIOS_H_FINI: equ 0xff16549BIOS_H_FINE: equ 0xff1b550BIOS_H_CRUN: equ 0xff20551BIOS_H_CRUS: equ 0xff25552BIOS_H_ISRE: equ 0xff2a553BIOS_H_NTFN: equ 0xff2f554BIOS_H_NOTR: equ 0xff34555BIOS_H_SNGF: equ 0xff39556BIOS_H_NEWS: equ 0xff3e557BIOS_H_GONE: equ 0xff43558BIOS_H_CHRG: equ 0xff48559BIOS_H_RETU: equ 0xff4d560BIOS_H_PRTF: equ 0xff52561BIOS_H_COMP: equ 0xff57562BIOS_H_FINP: equ 0xff5c563BIOS_H_TRMN: equ 0xff61564BIOS_H_FRME: equ 0xff66565BIOS_H_NTPL: equ 0xff6b566BIOS_H_EVAL: equ 0xff70567BIOS_H_OKNO: equ 0xff75568BIOS_H_FING: equ 0xff7a569BIOS_H_ISMI: equ 0xff7f570BIOS_H_WIDT: equ 0xff84571BIOS_H_LIST: equ 0xff89572BIOS_H_BUFL: equ 0xff8e573BIOS_H_FRQI: equ 0xff93574BIOS_H_SCNE: equ 0xff98575BIOS_H_FRET: equ 0xff9d576BIOS_H_PTRG: equ 0xffa2577BIOS_H_PHYD: equ 0xffa7578BIOS_H_FORM: equ 0xffac579BIOS_H_ERRO: equ 0xffb1580BIOS_H_LPTO: equ 0xffb6581BIOS_H_LPTS: equ 0xffbb582BIOS_H_SCRE: equ 0xffc0583BIOS_H_PLAY: equ 0xffc5585586BIOS_FCALL: equ 0xffca587BIOS_DISINT: equ 0xffcf588BIOS_ENAINT: equ 0xffd4592597598HKEYI: equ $fd9a 599HTIMI: equ $fd9f 601HOOK_SIZE: equ HTIMI - HKEYI604605MSXID1: equ $002b 609MSXID2: equ $002c 612MSXID3: equ $002d 617MSXID4: equ $002e 618MSXID5: equ $002f 619C:\Users\XDAD\source\repos\msx-tests\pt3-player.s10 Include/MsxConstants.s1PORT_0: equ 0x982PORT_1: equ 0x993PORT_2: equ 0x9a4PORT_3: equ 0x9b78PPI.A: equ $a8 10PPI.B: equ $a9 11PPI.C: equ $aa 17PPI.R: equ $ab 2328MEMORY_MAPPER_SEGMENT_PAGE_0: equ 0xfc29MEMORY_MAPPER_SEGMENT_PAGE_1: equ 0xfd30MEMORY_MAPPER_SEGMENT_PAGE_2: equ 0xfe31MEMORY_MAPPER_SEGMENT_PAGE_3: equ 0xff3337REG0SAV: equ 0xF3DF38REG1SAV: equ 0xF3E039REG2SAV: equ 0xF3E140REG3SAV: equ 0xF3E241REG4SAV: equ 0xF3E342REG5SAV: equ 0xF3E443REG6SAV: equ 0xF3E544REG7SAV: equ 0xF3E646REG8SAV: equ 0xFFE747REG9SAV: equ 0xFFE848REG10SAV: equ 0xFFE949REG11SAV: equ 0xFFEA50REG12SAV: equ 0xFFEB51REG13SAV: equ 0xFFEC52REG14SAV: equ 0xFFED53REG15SAV: equ 0xFFEE54REG16SAV: equ 0xFFEF55REG17SAV: equ 0xFFF056REG18SAV: equ 0xFFF157REG19SAV: equ 0xFFF258REG20SAV: equ 0xFFF359REG21SAV: equ 0xFFF460REG22SAV: equ 0xFFF561REG23SAV: equ 0xFFF66365REG25SAV: equ 0xFFFA66REG26SAV: equ 0xFFFB67REG27SAV: equ 0xFFFC68C:\Users\XDAD\source\repos\msx-tests\pt3-player.s11 Include/CommonRoutines.s14913172428SetPaletteColor:29 push bc30 31 ld b, a 32 ld c, 16 33 call BIOS_WRTVDP34 ld c, PORT_2 35 pop de37 ld a, d 38 di39 out (c), a40 ld a, e 41 ei42 out (c), a44 ret4853SetPaletteColor_FromAddress:54 55 ld b, a 56 ld c, 16 57 call BIOS_WRTVDP58 ld c, PORT_2 60 ld a, (hl) 61 di62 out (c), a63 inc hl64 ld a, (hl) 65 ei66 out (c), a68 ret7273LoadPalette:74 75 ld b, 0 76 ld c, 16 77 call BIOS_WRTVDP78 ld c, PORT_2 80 ld b, 1681.loop:82 di83 ld a, (hl)84 out (c), a85 inc hl86 ld a, (hl)87 out (c), a88 ei89 inc hl90 djnz .loop91 92 ret9697EnableRomPage2:98100 call BIOS_RSLREG101 rrca102 rrca103 and 3 104 ld c,a105 ld b,0106 ld hl, BIOS_EXPTBL107 add hl,bc108 ld a,(hl)109 and 80h110 or c111 ld c,a112 inc hl113 inc hl114 inc hl115 inc hl116 ld a,(hl)117 and 0Ch118 or c119 ld h,080h120 call BIOS_ENASLT 122 ret125129Wait_B_Vblanks:130 131 push bc132 133 .loop:135 ld a, (BIOS_JIFFY)136 ld c, a137 .waitVBlank:138 ld a, (BIOS_JIFFY)139 cp c140 jp z, .waitVBlank142 djnz .loop143 144 pop bc146 ret148Wait_15_Vblanks:149 ld c, 15151 .loop:152 ld a, (BIOS_JIFFY)153 ld b, a154 .waitVBlank:155 ld a, (BIOS_JIFFY)156 cp b157 jp z, .waitVBlank159 dec c160 jp nz, .loop162 ret164Wait_Vblank:165.loop:166 ld a, (BIOS_JIFFY)167 ld b, a168.waitVBlank:169 ld a, (BIOS_JIFFY)170 cp b171 jp z, .waitVBlank173 ret175177Wait:178 ld c, 15180 .loop:181 ld a, (BIOS_JIFFY)182 ld b, a183 .waitVBlank:184 ld a, (BIOS_JIFFY)185 cp b186 jp z, .waitVBlank188 dec c189 jp nz, .loop191195SetVdp_Write:197 206 rlc h207 rla208 rlc h209 rla210 srl h211 srl h213 di214 215 out (PORT_1), a216 ld a, 14 + 128217 out (PORT_1), a219 220 ld a, l221 nop222 out (PORT_1), a223 ld a, h224 or 64225 ei226 out (PORT_1),a227 ret229233SetVdp_Read:234 rlc h235 rla236 rlc h237 rla238 srl h239 srl h240 di241 out (PORT_1), a242 ld a, 14 + 128243 out (PORT_1), a244 ld a, l245 nop246 out (PORT_1), a247 ld a, h248 ei249 out (PORT_1), a250 ret253261282 283285287289291296304312315ClearVram_MSX2:316 xor a 317 ld hl, 0 318 call SetVDP_Write320330 xor a332 336 337 ld d, 2 338.loop_2:339 ld c, 0 340.loop_1:341 ld b, 0 342.loop:343 out (PORT_0), a344 djnz .loop345 dec c346 jp nz, .loop_1347 dec d348 jp nz, .loop_2350 ret353Screen11:354 356 ld a, 8357 call BIOS_CHGMOD359 ld a, (REG25SAV)360 or 0001 1000 b361 ld (REG25SAV), a 362 ld b, a363 364 ld c, 25 365 call BIOS_WRTVDP366 ret368SetSprites16x16:369 ld a, (REG1SAV)370 or 0000 0010 b371 ld b, a372 ld c, 1 373 call BIOS_WRTVDP374 ret376SetSpritesMagnified:377 ld a, (REG1SAV)378 or 0000 0001 b379 ld b, a380 ld c, 1 381 call BIOS_WRTVDP382 ret384Set192Lines:385 389 ld a, (REG9SAV)390 and 0111 1111 b391 ld b, a392 ld c, 9 393 call BIOS_WRTVDP394 ret396Set212Lines:397 398 ld a, (REG9SAV)399 or 1000 0000 b400 ld b, a401 ld c, 9 402 call BIOS_WRTVDP403 ret405SetNonInterlacedMode:406 407 ld a, (REG9SAV)408 and 1111 0011 b409 ld b, a410 ld c, 9 411 call BIOS_WRTVDP412 ret414SetInterlacedMode:415 416 ld a, (REG9SAV)417 or 0000 1100 b418 ld b, a419 ld c, 9 420 call BIOS_WRTVDP421 ret423SetColor0ToNonTransparent:424 429 ld a, (REG8SAV)430 or 0010 0000 b431 ld b, 0010 1000 b 432 ld c, 0x08 433 call BIOS_WRTVDP434 ret436SetColor0ToTransparent:437 438 ld a, (REG8SAV)439 and 1101 1111 b440 ld b, a441 ld c, 8 442 call BIOS_WRTVDP443 ret445DisableSprites:446 ld a, (REG8SAV)447 or 0000 0010 b448 ld b, a449 ld c, 8 450 call BIOS_WRTVDP451 ret453EnableSprites:454 ld a, (REG8SAV)455 and 1111 1101 b456 ld b, a457 ld c, 8 458 call BIOS_WRTVDP459 ret461465LDIRVM_MSX2:466 467 ex de, hl468 469 call SetVdp_Write470 ex de, hl471 ld d, c472 473 ld c, PORT_0 474 ld b, 0475.loop_1:476 otir477 dec d478 jp nz, .loop_1479 ret483501 510 514521CheckCollision_16x24_16x16:523 ld a, d 524 sub b 525 jr c, .x1IsLarger 526 sub 16 527 ret nc 528 jp .checkVerticalCollision529.x1IsLarger:530 neg 535 536 sub 16 537 ret nc 539.checkVerticalCollision:540 ld a, e 541 sub c 542 jr c, .y1IsLarger 543 sub 24 544 ret 545.y1IsLarger:546 neg 551 552 sub 16 553 ret 557562565575579582585590 591593600604606614 615623629636642645652658666668676683690693699701 703711716721725728739746751756759766771773779782784788792794797800803808 809812815 816821825828833 834837839 840845849853Execute_VDP_LMMM:854Execute_VDP_HMMM:855 ld a, 32 856 di857 out (PORT_1), a858 ld a, 17 + 128 859 out (PORT_1), a860 ld c, 0x9B 861.vdpReady:862 ld a, 2863 di864 out (PORT_1), a 865 ld a, 15 + 128866 out (PORT_1), a867 in a, (PORT_1)868 rra869 ld a, 0 870 out (PORT_1), a871 ld a, 15 + 128872 ei873 out (PORT_1), a 874 jp c, .vdpReady875 outi 876 outi 877 outi878 outi879 outi880 outi881 outi882 outi883 outi884 outi885 outi886 outi887 outi888 outi889 outi890 ret892895Execute_VDP_PSET:896Execute_VDP_LINE:897Execute_VDP_HMMV:898899 ld a, 36 900 di901 out (PORT_1), a902 ld a, 17 + 128903 out (PORT_1), a904 ld c, 0x9B905.vdpReady:906 ld a, 2907 di908 out (PORT_1), a 909 ld a, 15 + 128910 out (PORT_1), a911 in a, (PORT_1)912 rra913 ld a, 0 914 out (PORT_1), a915 ld a, 15 + 128916 ei917 out (PORT_1), a 918 jp c, .vdpReady919 outi 920 outi 921 outi922 outi923 outi924 outi925 outi926 outi927 outi928 outi929 outi930 ret932943948951 954956971975979 980985991997 9991002Execute_VDP_YMMM:1003 ld a, 34 1004 di1005 out (PORT_1), a1006 ld a, 17 + 1281007 out (PORT_1), a1008 ld c, 0x9B1009.vdpReady:1010 ld a, 21011 di1012 out (PORT_1), a 1013 ld a, 15 + 1281014 out (PORT_1), a1015 in a, (PORT_1)1016 rra1017 ld a, 0 1018 out (PORT_1), a1019 ld a, 15 + 1281020 ei1021 out (PORT_1), a 1022 jp c, .vdpReady1023 outi 1024 outi 1025 outi1026 outi1027 outi1028 outi1029 outi1030 outi1031 outi1032 outi1033 outi1034 outi1035 outi1036 ret10381042ReadStatusReg:10431044 ld a,(0007h) 1045 inc a1046 ld c,a 1048 out (c),b1049 ld a,080h+151050 out (c),a10511052 1053 ld a,(0006h) 1054 inc a1055 ld c,a 1056 in b,(c) 1057 10581059 ld a,(0007h) 1060 inc a1061 ld c,a 1062 xor a1063 out (c),a1064 ld a,080h+151065 out (c),a1066 1068 ret10711072WRTVDP_without_DI_EI:1073 ld a, b1074 1075 out (PORT_1),a1076 ld a, c1077 or 1281078 1080 out (PORT_1), a1081 ret10851088SNSMAT_NO_DI_EI:1089 ld c, a1090.C_OK:10911092 in a, (PPI.C)1093 and 0xf0 1094 or c10951096 out (PPI.C), a1097 in a, (PPI.B)1098 ret1099C:\Users\XDAD\source\repos\msx-tests\pt3-player.s13PT3_Music_sample:14 INCBIN "Sound/StayorGo.pt3"1719PHASE 0xc00021pt3_player:22 Include/pt3.asm181112Release: equ '6'142832353847START:48 LD HL,MDLADDR 49 JR INIT 50 JP PLAY 51 JR MUTE 52SETUP: db 0 54CrPsPtr: dw 0 5657 db "=VTII PT3 Player r.",Release,"="59CHECKLP: LD HL,SETUP60 SET 7,(HL)61 BIT 0,(HL)62 RET Z63 POP HL64 LD HL,DelyCnt65 INC (HL)66 LD HL,ChanA+CHNPRM_NtSkCn67 INC (HL)68MUTE: XOR A69 LD H,A70 LD L,A71 LD (AYREGS+AR_AmplA),A72 LD (AYREGS+AR_AmplB),HL73 JP ROUT_A075INIT:7678 LD (MODADDR),HL79 LD (MDADDR2),HL80 PUSH HL81 LD DE,10082 ADD HL,DE83 LD A,(HL)84 LD (Delay),A85 PUSH HL86 POP IX87 ADD HL,DE88 LD (CrPsPtr),HL89 LD E,(IX+102-100)90 ADD HL,DE91 INC HL92 LD (LPosPtr),HL93 POP DE94 LD L,(IX+103-100)95 LD H,(IX+104-100)96 ADD HL,DE97 LD (PatsPtr),HL98 LD HL,16999 ADD HL,DE100 LD (OrnPtrs),HL101 LD HL,105102 ADD HL,DE103 LD (SamPtrs),HL104 LD HL,SETUP105 RES 7,(HL)107108 LD DE,T_PACK109 LD BC,T1_+(2*49)-1110TP_0: LD A,(DE)111 INC DE112 CP 15*2113 JR NC,TP_1114 LD H,A115 LD A,(DE)116 LD L,A117 INC DE118 JR TP_2119TP_1: PUSH DE120 LD D,0121 LD E,A122 ADD HL,DE123 ADD HL,DE124 POP DE125TP_2: LD A,H126 LD (BC),A127 DEC BC128 LD A,L129 LD (BC),A130 DEC BC131 SUB 0xf0132 JR NZ,TP_0134 LD HL,VARS135 LD (HL),A136 LD DE,VARS+1137 LD BC,VAR0END-VARS-1138 LDIR139 INC A140 LD (DelyCnt),A141 LD HL,0xf001 142 LD (ChanA+CHNPRM_NtSkCn),HL143 LD (ChanB+CHNPRM_NtSkCn),HL144 LD (ChanC+CHNPRM_NtSkCn),HL146 LD HL,EMPTYSAMORN147 LD (AdInPtA),HL 148 LD (ChanA+CHNPRM_OrnPtr),HL 149 LD (ChanB+CHNPRM_OrnPtr),HL 150 LD (ChanC+CHNPRM_OrnPtr),HL 152 LD (ChanA+CHNPRM_SamPtr),HL 153 LD (ChanB+CHNPRM_SamPtr),HL 154 LD (ChanC+CHNPRM_SamPtr),HL 157 LD A,(IX+13-100) 158 SUB 0x30159 JR C,L20160 CP 10161 JR C,L21162L20: LD A,6163L21: LD (Version),A164 PUSH AF165 CP 4166 LD A,(IX+99-100) 167 RLA168 AND 7170174 LD HL,NT_DATA175 PUSH DE176 LD D,B177 ADD A,A178 LD E,A179 ADD HL,DE180 LD E,(HL)181 INC HL182 SRL E183 SBC A,A184 AND 0xa7 185 LD (L3),A186 EX DE,HL187 POP BC 188 ADD HL,BC190 LD A,(DE)192 LD BC,T_193 ADD A,C194 LD C,A195 ADC A,B197 SUB C198 LD B,A199 PUSH BC200 LD DE,NT_201 PUSH DE203 LD B,12204L1: PUSH BC205 LD C,(HL)206 INC HL207 PUSH HL208 LD B,(HL)210 PUSH DE211 EX DE,HL212 LD DE,23213 db 0xdD,0x26,0x08 215L2: SRL B216 RR C217L3: db 0x19 218 LD A,C219 ADC A,D 220 LD (HL),A221 INC HL222 LD A,B223 ADC A,D224 LD (HL),A225 ADD HL,DE226 db 0xdD,0x25 227 JR NZ,L2229 POP DE230 INC DE231 INC DE232 POP HL233 INC HL234 POP BC235 DJNZ L1237 POP HL238 POP DE240 LD A,E241 PUSH DE242 LD DE,TCOLD_1243 CP E244 POP DE245 JR NZ,CORR_1246 LD A,0xfD247 LD (NT_+0x2E),A248 249CORR_1:250 LD A,(DE)251 AND A252 JR Z,TC_EXIT253 RRA254 PUSH AF255 ADD A,A256 LD C,A257 ADD HL,BC258 POP AF259 JR NC,CORR_2260 DEC (HL)261 DEC (HL)262CORR_2: INC (HL)263 AND A264 SBC HL,BC265 INC DE266 JR CORR_1268TC_EXIT:270 POP AF272276 CP 5277 LD HL,0x11278 LD D,H279 LD E,H280 LD A,0x17281 JR NC,M1282 DEC L283 LD E,L284 XOR A285M1: LD (M2),A287 LD IX,VT_+16288 LD C,0x10290INITV2: PUSH HL292 ADD HL,DE293 EX DE,HL294 SBC HL,HL296INITV1: LD A,L297M2: db 0x7D298 LD A,H299 ADC A,0300 LD (IX),A301 INC IX302 ADD HL,DE303 INC C304 LD A,C305 AND 15306 JR NZ,INITV1308 POP HL309 LD A,E310 CP 0x77311 JR NZ,M3312 INC E313M3: LD A,C314 AND A315 JR NZ,INITV2317 JP ROUT_A0319320PD_OrSm: LD (IX-12+CHNPRM_Env_En),0321 CALL SETORN322 LD A,(BC)323 INC BC324 RRCA326PD_SAM: ADD A,A327PD_SAM_: LD E,A328 LD D,0329SamPtrs: equ $+1330 LD HL,0x2121331 ADD HL,DE332 LD E,(HL)333 INC HL334 LD D,(HL)335MODADDR: equ $+1336 LD HL,0x2121337 ADD HL,DE338 LD (IX-12+CHNPRM_SamPtr),L339 LD (IX-12+CHNPRM_SamPtr+1),H340 JR PD_LOOP342PD_VOL: RLCA343 RLCA344 RLCA345 RLCA346 LD (IX-12+CHNPRM_Volume),A347 JR PD_LP2348 349PD_EOff: LD (IX-12+CHNPRM_Env_En),A350 LD (IX-12+CHNPRM_PsInOr),A351 JR PD_LP2353PD_SorE: DEC A354 JR NZ,PD_ENV355 LD A,(BC)356 INC BC357 LD (IX-12+CHNPRM_NNtSkp),A358 JR PD_LP2360PD_ENV: CALL SETENV361 JR PD_LP2363PD_ORN: CALL SETORN364 JR PD_LOOP365 366PD_ESAM: LD (IX-12+CHNPRM_Env_En),A367 LD (IX-12+CHNPRM_PsInOr),A368 CALL NZ,SETENV369 LD A,(BC)370 INC BC371 JR PD_SAM_373PTDECOD: LD A,(IX-12+CHNPRM_Note)374 LD (PrNote+1),A375 LD L,(IX-12+CHNPRM_CrTnSl)376 LD H,(IX-12+CHNPRM_CrTnSl+1)377 LD (PrSlide+1),HL379PD_LOOP: LD DE,0x2010380PD_LP2: LD A,(BC)381 INC BC382 ADD A,E383 JR C,PD_OrSm384 ADD A,D385 JR Z,PD_FIN386 JR C,PD_SAM387 ADD A,E388 JR Z,PD_REL389 JR C,PD_VOL390 ADD A,E391 JR Z,PD_EOff392 JR C,PD_SorE393 ADD A,96394 JR C,PD_NOTE395 ADD A,E396 JR C,PD_ORN397 ADD A,D398 JR C,PD_NOIS399 ADD A,E400 JR C,PD_ESAM401 ADD A,A402 LD E,A403 404 PUSH DE405 LD DE,0xdF20406 LD HL,SPCCOMS 407 ADD HL,DE408 POP DE409 410 ADD HL,DE411 LD E,(HL)412 INC HL413 LD D,(HL)414 PUSH DE415 JR PD_LOOP417PD_NOIS: LD (Ns_Base),A418 JR PD_LP2420PD_REL: RES 0,(IX-12+CHNPRM_Flags)421 JR PD_RES422 423PD_NOTE: LD (IX-12+CHNPRM_Note),A424 SET 0,(IX-12+CHNPRM_Flags)425 XOR A427PD_RES: LD (PDSP_+1),SP428 LD SP,IX429 LD H,A430 LD L,A431 PUSH HL432 PUSH HL433 PUSH HL434 PUSH HL435 PUSH HL436 PUSH HL437PDSP_: LD SP,0x3131439PD_FIN: LD A,(IX-12+CHNPRM_NNtSkp)440 LD (IX-12+CHNPRM_NtSkCn),A441 RET443C_PORTM: RES 2,(IX-12+CHNPRM_Flags)444 LD A,(BC)445 INC BC446448 INC BC449 INC BC450 LD (IX-12+CHNPRM_TnSlDl),A451 LD (IX-12+CHNPRM_TSlCnt),A452 LD DE,NT_453 LD A,(IX-12+CHNPRM_Note)454 LD (IX-12+CHNPRM_SlToNt),A455 ADD A,A456 LD L,A457 LD H,0458 ADD HL,DE459 LD A,(HL)460 INC HL461 LD H,(HL)462 LD L,A463 PUSH HL464PrNote: LD A,0x3E465 LD (IX-12+CHNPRM_Note),A466 ADD A,A467 LD L,A468 LD H,0469 ADD HL,DE470 LD E,(HL)471 INC HL472 LD D,(HL)473 POP HL474 SBC HL,DE475 LD (IX-12+CHNPRM_TnDelt),L476 LD (IX-12+CHNPRM_TnDelt+1),H477 LD E,(IX-12+CHNPRM_CrTnSl)478 LD D,(IX-12+CHNPRM_CrTnSl+1)479Version: equ $+1480 LD A,0x3E481 CP 6482 JR C,OLDPRTM 483PrSlide: LD DE,0x1111484 LD (IX-12+CHNPRM_CrTnSl),E485 LD (IX-12+CHNPRM_CrTnSl+1),D486OLDPRTM: LD A,(BC) 487 INC BC488 EX AF,AF'489 LD A,(BC)490 INC BC491 AND A492 JR Z,NOSIG493 EX DE,HL494NOSIG: SBC HL,DE495 JP P,SET_STP496 CPL497 EX AF,AF'498 NEG499 EX AF,AF'500SET_STP: LD (IX-12+CHNPRM_TSlStp+1),A501 EX AF,AF'502 LD (IX-12+CHNPRM_TSlStp),A503 LD (IX-12+CHNPRM_COnOff),0504 RET506C_GLISS: SET 2,(IX-12+CHNPRM_Flags)507 LD A,(BC)508 INC BC509 LD (IX-12+CHNPRM_TnSlDl),A510 LD (IX-12+CHNPRM_TSlCnt),A511 LD A,(BC)512 INC BC513 EX AF,AF'514 LD A,(BC)515 INC BC516 JR SET_STP518C_SMPOS: LD A,(BC)519 INC BC520 LD (IX-12+CHNPRM_PsInSm),A521 RET523C_ORPOS: LD A,(BC)524 INC BC525 LD (IX-12+CHNPRM_PsInOr),A526 RET528C_VIBRT: LD A,(BC)529 INC BC530 LD (IX-12+CHNPRM_OnOffD),A531 LD (IX-12+CHNPRM_COnOff),A532 LD A,(BC)533 INC BC534 LD (IX-12+CHNPRM_OffOnD),A535 XOR A536 LD (IX-12+CHNPRM_TSlCnt),A537 LD (IX-12+CHNPRM_CrTnSl),A538 LD (IX-12+CHNPRM_CrTnSl+1),A539 RET541C_ENGLS: LD A,(BC)542 INC BC543 LD (Env_Del),A544 LD (CurEDel),A545 LD A,(BC)546 INC BC547 LD L,A548 LD A,(BC)549 INC BC550 LD H,A551 LD (ESldAdd),HL552 RET554C_DELAY: LD A,(BC)555 INC BC556 LD (Delay),A557 RET558 559SETENV: LD (IX-12+CHNPRM_Env_En),E560 LD (AYREGS+AR_EnvTp),A561 LD A,(BC)562 INC BC563 LD H,A564 LD A,(BC)565 INC BC566 LD L,A567 LD (EnvBase),HL568 XOR A569 LD (IX-12+CHNPRM_PsInOr),A570 LD (CurEDel),A571 LD H,A572 LD L,A573 LD (CurESld),HL574C_NOP: RET576SETORN: ADD A,A577 LD E,A578 LD D,0579 LD (IX-12+CHNPRM_PsInOr),D580OrnPtrs: equ $+1581 LD HL,0x2121582 ADD HL,DE583 LD E,(HL)584 INC HL585 LD D,(HL)586MDADDR2: equ $+1587 LD HL,0x2121588 ADD HL,DE589 LD (IX-12+CHNPRM_OrnPtr),L590 LD (IX-12+CHNPRM_OrnPtr+1),H591 RET593594SPCCOMS: dw C_NOP595 dw C_GLISS596 dw C_PORTM597 dw C_SMPOS598 dw C_ORPOS599 dw C_VIBRT600 dw C_NOP601 dw C_NOP602 dw C_ENGLS603 dw C_DELAY604 dw C_NOP605 dw C_NOP606 dw C_NOP607 dw C_NOP608 dw C_NOP609 dw C_NOP611CHREGS: XOR A612 LD (Ampl),A613 BIT 0,(IX+CHNPRM_Flags)614 PUSH HL615 JP Z,CH_EXIT616 LD (CSP_+1),SP617 LD L,(IX+CHNPRM_OrnPtr)618 LD H,(IX+CHNPRM_OrnPtr+1)619 LD SP,HL620 POP DE621 LD H,A622 LD A,(IX+CHNPRM_PsInOr)623 LD L,A624 ADD HL,SP625 INC A626 CP D627 JR C,CH_ORPS628 LD A,E629CH_ORPS: LD (IX+CHNPRM_PsInOr),A630 LD A,(IX+CHNPRM_Note)631 ADD A,(HL)632 JP P,CH_NTP633 XOR A634CH_NTP: CP 96635 JR C,CH_NOK636 LD A,95637CH_NOK: ADD A,A638 EX AF,AF'639 LD L,(IX+CHNPRM_SamPtr)640 LD H,(IX+CHNPRM_SamPtr+1)641 LD SP,HL642 POP DE643 LD H,0644 LD A,(IX+CHNPRM_PsInSm)645 LD B,A646 ADD A,A647 ADD A,A648 LD L,A649 ADD HL,SP650 LD SP,HL651 LD A,B652 INC A653 CP D654 JR C,CH_SMPS655 LD A,E656CH_SMPS: LD (IX+CHNPRM_PsInSm),A657 POP BC658 POP HL659 LD E,(IX+CHNPRM_TnAcc)660 LD D,(IX+CHNPRM_TnAcc+1)661 ADD HL,DE662 BIT 6,B663 JR Z,CH_NOAC664 LD (IX+CHNPRM_TnAcc),L665 LD (IX+CHNPRM_TnAcc+1),H666CH_NOAC: EX DE,HL667 EX AF,AF'668 LD L,A669 LD H,0670 LD SP,NT_671 ADD HL,SP672 LD SP,HL673 POP HL674 ADD HL,DE675 LD E,(IX+CHNPRM_CrTnSl)676 LD D,(IX+CHNPRM_CrTnSl+1)677 ADD HL,DE678CSP_: LD SP,0x3131679 EX (SP),HL680 XOR A681 OR (IX+CHNPRM_TSlCnt)682 JR Z,CH_AMP683 DEC (IX+CHNPRM_TSlCnt)684 JR NZ,CH_AMP685 LD A,(IX+CHNPRM_TnSlDl)686 LD (IX+CHNPRM_TSlCnt),A687 LD L,(IX+CHNPRM_TSlStp)688 LD H,(IX+CHNPRM_TSlStp+1)689 LD A,H690 ADD HL,DE691 LD (IX+CHNPRM_CrTnSl),L692 LD (IX+CHNPRM_CrTnSl+1),H693 BIT 2,(IX+CHNPRM_Flags)694 JR NZ,CH_AMP695 LD E,(IX+CHNPRM_TnDelt)696 LD D,(IX+CHNPRM_TnDelt+1)697 AND A698 JR Z,CH_STPP699 EX DE,HL700CH_STPP: SBC HL,DE701 JP M,CH_AMP702 LD A,(IX+CHNPRM_SlToNt)703 LD (IX+CHNPRM_Note),A704 XOR A705 LD (IX+CHNPRM_TSlCnt),A706 LD (IX+CHNPRM_CrTnSl),A707 LD (IX+CHNPRM_CrTnSl+1),A708CH_AMP: LD A,(IX+CHNPRM_CrAmSl)709 BIT 7,C710 JR Z,CH_NOAM711 BIT 6,C712 JR Z,CH_AMIN713 CP 15714 JR Z,CH_NOAM715 INC A716 JR CH_SVAM717CH_AMIN: CP -15718 JR Z,CH_NOAM719 DEC A720CH_SVAM: LD (IX+CHNPRM_CrAmSl),A721CH_NOAM: LD L,A722 LD A,B723 AND 15724 ADD A,L725 JP P,CH_APOS726 XOR A727CH_APOS: CP 16728 JR C,CH_VOL729 LD A,15730CH_VOL: OR (IX+CHNPRM_Volume)731 LD L,A732 LD H,0733 LD DE,VT_734 ADD HL,DE735 LD A,(HL)736CH_ENV: BIT 0,C737 JR NZ,CH_NOEN738 OR (IX+CHNPRM_Env_En)739CH_NOEN: LD (Ampl),A740 BIT 7,B741 LD A,C742 JR Z,NO_ENSL743 RLA744 RLA745 SRA A746 SRA A747 SRA A748 ADD A,(IX+CHNPRM_CrEnSl) 749 BIT 5,B750 JR Z,NO_ENAC751 LD (IX+CHNPRM_CrEnSl),A752NO_ENAC: LD HL,AddToEn753 ADD A,(HL) 755 LD (HL),A756 JR CH_MIX757NO_ENSL: RRA758 ADD A,(IX+CHNPRM_CrNsSl)759 LD (AddToNs),A760 BIT 5,B761 JR Z,CH_MIX762 LD (IX+CHNPRM_CrNsSl),A763CH_MIX: LD A,B764 RRA765 AND 0x48766CH_EXIT: LD HL,AYREGS+AR_Mixer767 OR (HL)768 RRCA769 LD (HL),A770 POP HL771 XOR A772 OR (IX+CHNPRM_COnOff)773 RET Z774 DEC (IX+CHNPRM_COnOff)775 RET NZ776 XOR (IX+CHNPRM_Flags)777 LD (IX+CHNPRM_Flags),A778 RRA779 LD A,(IX+CHNPRM_OnOffD)780 JR C,CH_ONDL781 LD A,(IX+CHNPRM_OffOnD)782CH_ONDL: LD (IX+CHNPRM_COnOff),A783 RET785PLAY: XOR A786 LD (AddToEn),A787 LD (AYREGS+AR_Mixer),A788 DEC A789 LD (AYREGS+AR_EnvTp),A790 LD HL,DelyCnt791 DEC (HL)792 JR NZ,PL2793 LD HL,ChanA+CHNPRM_NtSkCn794 DEC (HL)795 JR NZ,PL1B796AdInPtA: equ $+1797 LD BC,0x0101798 LD A,(BC)799 AND A800 JR NZ,PL1A801 LD D,A802 LD (Ns_Base),A803 LD HL,(CrPsPtr)804 INC HL805 LD A,(HL)806 INC A807 JR NZ,PLNLP808 CALL CHECKLP809LPosPtr: equ $+1810 LD HL,0x2121811 LD A,(HL)812 INC A813PLNLP: LD (CrPsPtr),HL814 DEC A815 ADD A,A816 LD E,A817 RL D818PatsPtr: equ $+1819 LD HL,0x2121820 ADD HL,DE821 LD DE,(MODADDR)822 LD (PSP_+1),SP823 LD SP,HL824 POP HL825 ADD HL,DE826 LD B,H827 LD C,L828 POP HL829 ADD HL,DE830 LD (AdInPtB),HL831 POP HL832 ADD HL,DE833 LD (AdInPtC),HL834PSP_: LD SP,0x3131835PL1A: LD IX,ChanA+12836 CALL PTDECOD837 LD (AdInPtA),BC839PL1B: LD HL,ChanB+CHNPRM_NtSkCn840 DEC (HL)841 JR NZ,PL1C842 LD IX,ChanB+12843AdInPtB: equ $+1844 LD BC,0x0101845 CALL PTDECOD846 LD (AdInPtB),BC848PL1C: LD HL,ChanC+CHNPRM_NtSkCn849 DEC (HL)850 JR NZ,PL1D851 LD IX,ChanC+12852AdInPtC: equ $+1853 LD BC,0x0101854 CALL PTDECOD855 LD (AdInPtC),BC857Delay: equ $+1858PL1D: LD A,0x3E859 LD (DelyCnt),A861PL2: LD IX,ChanA862 LD HL,(AYREGS+AR_TonA)863 CALL CHREGS864 LD (AYREGS+AR_TonA),HL865 LD A,(Ampl)866 LD (AYREGS+AR_AmplA),A867 LD IX,ChanB868 LD HL,(AYREGS+AR_TonB)869 CALL CHREGS870 LD (AYREGS+AR_TonB),HL871 LD A,(Ampl)872 LD (AYREGS+AR_AmplB),A873 LD IX,ChanC874 LD HL,(AYREGS+AR_TonC)875 CALL CHREGS876878 LD (AYREGS+AR_TonC),HL880 LD HL,(Ns_Base_AddToNs)881 LD A,H882 ADD A,L883 LD (AYREGS+AR_Noise),A885AddToEn: equ $+1886 LD A,0x3E887 LD E,A888 ADD A,A889 SBC A,A890 LD D,A891 LD HL,(EnvBase)892 ADD HL,DE893 LD DE,(CurESld)894 ADD HL,DE895 LD (AYREGS+AR_Env),HL897 XOR A898 LD HL,CurEDel899 OR (HL)900 JR Z,ROUT_A0901 DEC (HL)902 JR NZ,ROUT903Env_Del: equ $+1904 LD A,0x3E905 LD (HL),A906ESldAdd: equ $+1907 LD HL,0x2121908 ADD HL,DE909 LD (CurESld),HL911ROUT: XOR A912ROUT_A0:913 LD C,0xa0914 LD HL,AYREGS915LOUT: OUT (C),A916 INC C917 OUTI 918 DEC C919 INC A920 CP 13921 JR NZ,LOUT922 OUT (C),A923 LD A,(HL)924 AND A925 RET M926 INC C927 OUT (C),A928 RET930NT_DATA: db (T_NEW_0-T1_)*2931 db TCNEW_0-T_932 db (T_OLD_0-T1_)*2+1933 db TCOLD_0-T_934 db (T_NEW_1-T1_)*2+1935 db TCNEW_1-T_936 db (T_OLD_1-T1_)*2+1937 db TCOLD_1-T_938 db (T_NEW_2-T1_)*2939 db TCNEW_2-T_940 db (T_OLD_2-T1_)*2941 db TCOLD_2-T_942 db (T_NEW_3-T1_)*2943 db TCNEW_3-T_944 db (T_OLD_3-T1_)*2945 db TCOLD_3-T_947T_:949TCOLD_0: db 0x00+1,0x04+1,0x08+1,0x0A+1,0x0C+1,0x0E+1,0x12+1,0x14+1950 db 0x18+1,0x24+1,0x3C+1,0951TCOLD_1: db 0x5C+1,0952TCOLD_2: db 0x30+1,0x36+1,0x4C+1,0x52+1,0x5E+1,0x70+1,0x82,0x8C,0x9C953 db 0x9E,0xa0,0xa6,0xa8,0xaA,0xaC,0xaE,0xaE,0954TCNEW_3: db 0x56+1955TCOLD_3: db 0x1E+1,0x22+1,0x24+1,0x28+1,0x2C+1,0x2E+1,0x32+1,0xbE+1,0956TCNEW_0: db 0x1C+1,0x20+1,0x22+1,0x26+1,0x2A+1,0x2C+1,0x30+1,0x54+1957 db 0xbC+1,0xbE+1,0958TCNEW_1: equ TCOLD_1959TCNEW_2: db 0x1A+1,0x20+1,0x24+1,0x28+1,0x2A+1,0x3A+1,0x4C+1,0x5E+1960 db 0xbA+1,0xbC+1,0xbE+1,0962EMPTYSAMORN: equ $-1963 db 1,0,0x90 965967T_PACK: db 0x06EC*2/256,0x06EC*2968 db 0x0755-0x06EC969 db 0x07C5-0x0755970 db 0x083B-0x07C5971 db 0x08B8-0x083B972 db 0x093D-0x08B8973 db 0x09CA-0x093D974 db 0x0A5F-0x09CA975 db 0x0AFC-0x0A5F976 db 0x0BA4-0x0AFC977 db 0x0C55-0x0BA4978 db 0x0D10-0x0C55979 db 0x066D*2/256,0x066D*2980 db 0x06CF-0x066D981 db 0x0737-0x06CF982 db 0x07A4-0x0737983 db 0x0819-0x07A4984 db 0x0894-0x0819985 db 0x0917-0x0894986 db 0x09A1-0x0917987 db 0x0A33-0x09A1988 db 0x0ACF-0x0A33989 db 0x0B73-0x0ACF990 db 0x0C22-0x0B73991 db 0x0CDA-0x0C22992 db 0x0704*2/256,0x0704*2993 db 0x076E-0x0704994 db 0x07E0-0x076E995 db 0x0858-0x07E0996 db 0x08D6-0x0858997 db 0x095C-0x08D6998 db 0x09EC-0x095C999 db 0x0A82-0x09EC1000 db 0x0B22-0x0A821001 db 0x0BCC-0x0B221002 db 0x0C80-0x0BCC1003 db 0x0D3E-0x0C801004 db 0x07E0*2/256,0x07E0*21005 db 0x0858-0x07E01006 db 0x08E0-0x08581007 db 0x0960-0x08E01008 db 0x09F0-0x09601009 db 0x0A88-0x09F01010 db 0x0B28-0x0A881011 db 0x0BD8-0x0B281012 db 0x0C80-0x0BD81013 db 0x0D60-0x0C801014 db 0x0E10-0x0D601015 db 0x0EF8-0x0E1010171020VARS:10221025CHNPRM_PsInOr: equ 0 1026CHNPRM_PsInSm: equ 1 1027CHNPRM_CrAmSl: equ 2 1028CHNPRM_CrNsSl: equ 3 1029CHNPRM_CrEnSl: equ 4 1030CHNPRM_TSlCnt: equ 5 1031CHNPRM_CrTnSl: equ 6 1032CHNPRM_TnAcc: equ 8 1033CHNPRM_COnOff: equ 10 1036CHNPRM_OnOffD: equ 11 10381039CHNPRM_OffOnD: equ 12 1040CHNPRM_OrnPtr: equ 13 1041CHNPRM_SamPtr: equ 15 1042CHNPRM_NNtSkp: equ 17 1043CHNPRM_Note: equ 18 1044CHNPRM_SlToNt: equ 19 1045CHNPRM_Env_En: equ 20 1046CHNPRM_Flags: equ 21 1048CHNPRM_TnSlDl: equ 22 1049CHNPRM_TSlStp: equ 23 1050CHNPRM_TnDelt: equ 25 1051CHNPRM_NtSkCn: equ 27 1052CHNPRM_Volume: equ 28 1053CHNPRM_Size: equ 29 1056ChanA: ds CHNPRM_Size1057ChanB: ds CHNPRM_Size1058ChanC: ds CHNPRM_Size10601061AR_TonA: equ 0 1062AR_TonB: equ 2 1063AR_TonC: equ 4 1064AR_Noise: equ 6 1065AR_Mixer: equ 7 1066AR_AmplA: equ 8 1067AR_AmplB: equ 9 1068AR_AmplC: equ 10 1069AR_Env: equ 11 1070AR_EnvTp: equ 13 10731074DelyCnt: db 01075CurESld: dw 01076CurEDel: db 01077Ns_Base_AddToNs:1078Ns_Base: db 01079AddToNs: db 01081AYREGS:1083VT_: ds 256 1085EnvBase: equ VT_+141087T1_: equ VT_+16 1089T_OLD_1: equ T1_1090T_OLD_2: equ T_OLD_1+241091T_OLD_3: equ T_OLD_2+241092T_OLD_0: equ T_OLD_3+21093T_NEW_0: equ T_OLD_01094T_NEW_1: equ T_OLD_11095T_NEW_2: equ T_NEW_0+241096T_NEW_3: equ T_OLD_31098NT_: ds 192 11001101Ampl: equ AYREGS+AR_AmplC1103VAR0END: equ VT_+16 1105VARSEND: equ $1107MDLADDR: equ $ 11091171C:\Users\XDAD\source\repos\msx-tests\pt3-player.s23pt3_player.size: equ $ - pt3_player25DEPHASE27Execute:29 30 ld hl, pt3_player31 ld de, pt3_player_ram_addr32 ld bc, pt3_player.size33 ldir35 ld hl, PT3_Music_sample36 call INIT38.loop:40 41 ld a, (BIOS_JIFFY)42 ld b, a43.waitVBlank:44 ld a, (BIOS_JIFFY)45 cp b46 jp z, .waitVBlank48 call PLAY50 51 jp .loop53 db "End ROM started at 0x4000"55 ds PageSize - ($ - 0x4000), 255 5960 org 0xc000, 0xe5ff63pt3_player_ram_addr: rb pt3_player.size