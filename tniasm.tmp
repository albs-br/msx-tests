C:\Users\albs_\source\repos\msx-tests\pt3-player-msxlib.s1FNAME "pt3-player-msxlib.rom" 3PageSize: equ 0x4000 56 org 0x40008 Include/RomHeader.s12 db "AB" 3 dw Execute 4 dw 0 6 dw 0 8 dw 0 9 dw 0, 0, 0 10 11C:\Users\albs_\source\repos\msx-tests\pt3-player-msxlib.s9 Include/MsxBios.s189BIOS_HWVER: equ 0x002d1112BIOS_CGTABL: equ 0x0004 13BIOS_VDP_DR: equ 0x0006 14BIOS_VDP_DW: equ 0x0007 1617BIOS_CHKRAM: equ 0x000018BIOS_SYNCHR: equ 0x000819BIOS_RDSLT: equ 0x000c20BIOS_CHRGTR: equ 0x001021BIOS_WRSLT: equ 0x001422BIOS_OUTDO: equ 0x001823BIOS_CALSLT: equ 0x001c24BIOS_DCOMPR: equ 0x002025BIOS_ENASLT: equ 0x002426BIOS_GETYPR: equ 0x002827BIOS_CALLF: equ 0x003028BIOS_KEYINT: equ 0x00383031BIOS_INITIO: equ 0x003b32BIOS_INIFNK: equ 0x003e3435BIOS_DISSCR: equ 0x004136BIOS_ENASCR: equ 0x004437BIOS_WRTVDP: equ 0x004738BIOS_RDVRM: equ 0x004a39BIOS_WRTVRM: equ 0x004d40BIOS_SETRD: equ 0x005041BIOS_SETWRT: equ 0x005342BIOS_FILVRM: equ 0x005643BIOS_LDIRMV: equ 0x005944BIOS_LDIRVM: equ 0x005c45BIOS_CHGMOD: equ 0x005f46BIOS_CHGCLR: equ 0x006247BIOS_NMI: equ 0x006648BIOS_CLRSPR: equ 0x006949BIOS_INITXT: equ 0x006c50BIOS_INIT32: equ 0x006f51BIOS_INIGRP: equ 0x007252BIOS_INIMLT: equ 0x007553BIOS_SETTXT: equ 0x007854BIOS_SETT32: equ 0x007b55BIOS_SETGRP: equ 0x007e56BIOS_SETMLT: equ 0x008157BIOS_CALPAT: equ 0x008458BIOS_CALATR: equ 0x008759BIOS_GSPSIZ: equ 0x008a60BIOS_GRPPRT: equ 0x008d6263BIOS_GICINI: equ 0x009064BIOS_WRTPSG: equ 0x009365BIOS_RDPSG: equ 0x009666BIOS_STRTMS: equ 0x00996869BIOS_CHSNS: equ 0x009c70BIOS_CHGET: equ 0x009f71BIOS_CHPUT: equ 0x00a272BIOS_LPTOUT: equ 0x00a573BIOS_LPTSTT: equ 0x00a874BIOS_CNVCHR: equ 0x00ab75BIOS_PINLIN: equ 0x00ae76BIOS_INLIN: equ 0x00b177BIOS_QINLIN: equ 0x00b478BIOS_BREAKX: equ 0x00b779BIOS_BEEP: equ 0x00c080BIOS_CLS: equ 0x00c381BIOS_POSIT: equ 0x00c682BIOS_FNKSB: equ 0x00c983BIOS_ERAFNK: equ 0x00cc84BIOS_DSPFNK: equ 0x00cf85BIOS_TOTEXT: equ 0x00d28788BIOS_GTSTCK: equ 0x00d589BIOS_GTTRIG: equ 0x00d890BIOS_GTPAD: equ 0x00db91BIOS_GTPDL: equ 0x00de9394BIOS_TAPION: equ 0x00e195BIOS_TAPIN: equ 0x00e496BIOS_TAPIOF: equ 0x00e797BIOS_TAPOON: equ 0x00ea98BIOS_TAPOUT: equ 0x00ed99BIOS_TAPOOF: equ 0x00f0100BIOS_STMOTR: equ 0x00f3102103BIOS_CHGCAP: equ 0x0132104BIOS_CHGSND: equ 0x0135105BIOS_RSLREG: equ 0x0138106BIOS_WSLREG: equ 0x013b107BIOS_RDVDP: equ 0x013e108BIOS_SNSMAT: equ 0x0141109BIOS_PHYDIO: equ 0x0144110BIOS_ISFLIO: equ 0x014a111BIOS_OUTDLP: equ 0x014d112BIOS_KILBUF: equ 0x0156113BIOS_CALBAS: equ 0x0159115116BIOS_SUBROM: equ 0x015c117BIOS_EXTROM: equ 0x015f118BIOS_EOL: equ 0x0168119BIOS_BIGFIL: equ 0x016b120BIOS_NSETRD: equ 0x016e121BIOS_NSTWRT: equ 0x0171122BIOS_NRDVRM: equ 0x0174123BIOS_NWRVRM: equ 0x0177125126BIOS_GRPRT: equ 0x0089127BIOS_NVBXLN: equ 0x00c9128BIOS_NVBXFL: equ 0x00cd129BIOS_CLSSUB: equ 0x0115130BIOS_VDPSTA: equ 0x0131131BIOS_SETPAG: equ 0x013d132BIOS_INIPLT: equ 0x0141133BIOS_RSTPLT: equ 0x0145134BIOS_GETPLT: equ 0x0149135BIOS_SETPLT: equ 0x014d136BIOS_PROMPT: equ 0x0181137BIOS_NEWPAD: equ 0x01ad138BIOS_CHGMDP: equ 0x01b5139BIOS_KNJPRT: equ 0x01bd140BIOS_REDCLK: equ 0x01f5141BIOS_WRTCLK: equ 0x01f9143144BIOS_RDPRIM: equ 0xf380145BIOS_WRPRIM: equ 0xf385146BIOS_CLPRIM: equ 0xf38c148149BIOS_USRTAB: equ 0xf39a150BIOS_LINL40: equ 0xf3ae151BIOS_LINL32: equ 0xf3af152BIOS_LINLEN: equ 0xf3b0153BIOS_CRTCNT: equ 0xf3b1154BIOS_CLMLST: equ 0xf3b2156157BIOS_TXTNAM: equ 0xf3b3158BIOS_TXTCOL: equ 0xf3b5159BIOS_TXTCGP: equ 0xf3b7160BIOS_TXTATR: equ 0xf3b9161BIOS_TXTPAT: equ 0xf3bb163164BIOS_T32NAM: equ 0xf3bd165BIOS_T32COL: equ 0xf3bf166BIOS_T32CGP: equ 0xf3c1167BIOS_T32ATR: equ 0xf3c3168BIOS_T32PAT: equ 0xf3c5170171BIOS_GRPNAM: equ 0xf3c7172BIOS_GRPCOL: equ 0xf3c9173BIOS_GRPCGP: equ 0xf3cb174BIOS_GRPATR: equ 0xf3cd175BIOS_GRPPAT: equ 0xf3cf177178BIOS_MLTNAM: equ 0xf3d1179BIOS_MLTCOL: equ 0xf3d3180BIOS_MLTCGP: equ 0xf3d5181BIOS_MLTATR: equ 0xf3d7182BIOS_MLTPAT: equ 0xf3d9184185BIOS_CLIKSW: equ 0xf3db186BIOS_CSRY: equ 0xf3dc187BIOS_CSRX: equ 0xf3dd188BIOS_CNSDFG: equ 0xf3de190191BIOS_RG0SAV: equ 0xf3df192BIOS_RG1SAV: equ 0xf3e0193BIOS_RG2SAV: equ 0xf3e1194BIOS_RG3SAV: equ 0xf3e2195BIOS_RG4SAV: equ 0xf3e3196BIOS_RG5SAV: equ 0xf3e4197BIOS_RG6SAV: equ 0xf3e5198BIOS_RG7SAV: equ 0xf3e6199BIOS_RG8SAV: equ 0xffe7200BIOS_RG9SAV: equ 0xffe8201BIOS_STATFL: equ 0xf3e7202BIOS_TRGFLG: equ 0xf3e8203BIOS_FORCLR: equ 0xf3e9204BIOS_BAKCLR: equ 0xf3ea205BIOS_BDRCLR: equ 0xf3eb206BIOS_MAXUPD: equ 0xf3ec207BIOS_MINUPD: equ 0xf3ef208BIOS_ATRBYT: equ 0xf3f2210211BIOS_QUEUES: equ 0xf3f3212BIOS_FRCNEW: equ 0xf3f5214215BIOS_SCNCNT: equ 0xf3f6216BIOS_REPCNT: equ 0xf3f7217BIOS_PUTPNT: equ 0xf3f8218BIOS_GETPNT: equ 0xf3fa220221BIOS_CS120: equ 0xf3fc222BIOS_LOW: equ 0xf406223BIOS_HIGH: equ 0xf408224BIOS_HEADER: equ 0xf40a225BIOS_ASPCT1: equ 0xf40b226BIOS_ASPCT2: equ 0xf40d227BIOS_ENDPRG: equ 0xf40f229230BIOS_ERRFLG: equ 0xf414231BIOS_LPTPOS: equ 0xf415232BIOS_PRTFLG: equ 0xf416233BIOS_NTMSXP: equ 0xf417234BIOS_RAWPRT: equ 0xf418235BIOS_VLZADR: equ 0xf419236BIOS_VLZDAT: equ 0xf41b237BIOS_CURLIN: equ 0xf41c238BIOS_KBUF: equ 0xf41f239BIOS_BUFMIN: equ 0xf55d240BIOS_BUF: equ 0xf55e241BIOS_ENDBUF: equ 0xf660242BIOS_TTYPOS: equ 0xf661243BIOS_DIMFLG: equ 0xf662244BIOS_VALTYP: equ 0xf663245BIOS_DORES: equ 0xf664246BIOS_DONUM: equ 0xf665247BIOS_CONTXT: equ 0xf666248BIOS_CONSAV: equ 0xf668249BIOS_CONTYP: equ 0xf669250BIOS_CONLO: equ 0xf66a251BIOS_MEMSIZ: equ 0xf672252BIOS_STKTOP: equ 0xf674253BIOS_TXTTAB: equ 0xf676254BIOS_TEMPPT: equ 0xf768255BIOS_TEMPST: equ 0xf67a256BIOS_DSCTMP: equ 0xf698257BIOS_FRETOP: equ 0xf69b258BIOS_TEMP3: equ 0xf69d259BIOS_TEMP8: equ 0xf69f260BIOS_ENDFOR: equ 0xf6a1261BIOS_SUBFLG: equ 0xf6a5262BIOS_FLGINP: equ 0xf6a6263BIOS_TEMP: equ 0xf6a7264BIOS_PTRFLG: equ 0xf6a9265BIOS_AUTFLG: equ 0xf6aa266BIOS_AUTLIN: equ 0xf6ab267BIOS_AUTINC: equ 0xf6ad268BIOS_SAVTXT: equ 0xf6af269BIOS_ERRLIN: equ 0xf6b3270BIOS_DOT: equ 0xf6b5271BIOS_ERRTXT: equ 0xf6b7272BIOS_ONELIN: equ 0xf6b9273BIOS_ONEFLG: equ 0xf6bb274BIOS_TEMP2: equ 0xf6bc275BIOS_OLDLIN: equ 0xf6be276BIOS_OLDTXT: equ 0xf6c0277BIOS_VARTAB: equ 0xf6c2278BIOS_ARYTAB: equ 0xf6c4279BIOS_STREND: equ 0xf6c6280BIOS_DATPTR: equ 0xf6c8281BIOS_DEFTBL: equ 0xf6ca282BIOS_PRMSTK: equ 0xf6e4283BIOS_PRMLEN: equ 0xf6e6284BIOS_PARM1: equ 0xf6e8285BIOS_PRMPRV: equ 0xf74c286BIOS_PRMLN2: equ 0xf74e287BIOS_PARM2: equ 0xf750288BIOS_PRMFLG: equ 0xf7b4289BIOS_ARYTA2: equ 0xf7b5290BIOS_NOFUNS: equ 0xf7b7291BIOS_TEMP9: equ 0xf7b8292BIOS_FUNACT: equ 0xf7ba293BIOS_SWPTMP: equ 0xf7bc294BIOS_TRCFLG: equ 0xf7c4296297BIOS_FBUFFR: equ 0xf7c5298BIOS_DECTMP: equ 0xf7f0299BIOS_DECTM2: equ 0xf7f2300BIOS_DECCNT: equ 0xf7f4301BIOS_DAC: equ 0xf7f6302BIOS_HOLD8: equ 0xf806303BIOS_HOLD2: equ 0xf836304BIOS_HOLD: equ 0xf83e305BIOS_ARG: equ 0xf847306BIOS_RNDX: equ 0xf857308309BIOS_USRDATA: equ 0xf7f8311312BIOS_MAXFIL: equ 0xf85f313BIOS_FILTAB: equ 0xf860314BIOS_NULBUF: equ 0xf862315BIOS_PTRFIL: equ 0xf864316BIOS_RUNFLG: equ 0xf866317BIOS_FILNAM: equ 0xf866318BIOS_FILNM2: equ 0xf871319BIOS_NLONLY: equ 0xf87c320BIOS_SAVEND: equ 0xf87d321BIOS_FNKSTR: equ 0xf87f322BIOS_CGPNT: equ 0xf91f323BIOS_NAMBAS: equ 0xf922324BIOS_CGPBAS: equ 0xf924325BIOS_PATBAS: equ 0xf926326BIOS_ATRBAS: equ 0xf928327BIOS_CLOC: equ 0xf92a328BIOS_CMASK: equ 0xf92c329BIOS_MINDEL: equ 0xf92d330BIOS_MAXDEL: equ 0xf92f332333BIOS_ASPECT: equ 0xf931334BIOS_CENCNT: equ 0xf933335BIOS_CLINEF: equ 0xf935336BIOS_CNPNTS: equ 0xf936337BIOS_CPLOTF: equ 0xf938338BIOS_CPCNT: equ 0xf939339BIOS_CPNCNT8: equ 0xf93b340BIOS_CPCSUM: equ 0xf93d341BIOS_CSTCNT: equ 0xf93f342BIOS_CSCLXY: equ 0xf941343BIOS_CSAVEA: equ 0xf942344BIOS_CSAVEM: equ 0xf944345BIOS_CXOFF: equ 0xf945346BIOS_CYOFF: equ 0xf947348349BIOS_LOHMSK: equ 0xf949350BIOS_LOHDIR: equ 0xf94a351BIOS_LOHADR: equ 0xf94b352BIOS_LOHCNT: equ 0xf94d353BIOS_SKPCNT: equ 0xf94f354BIOS_MIVCNT: equ 0xf951355BIOS_PDIREC: equ 0xf953356BIOS_LFPROG: equ 0xf954357BIOS_RTPROG: equ 0xf955359360BIOS_MCLTAB: equ 0xf956361BIOS_MCLFLG: equ 0xf958362BIOS_QUETAB: equ 0xf959363BIOS_QUEBAK: equ 0xf971364BIOS_VOICAQ: equ 0xf975365BIOS_VOICBQ: equ 0xf9f5366BIOS_VOICCQ: equ 0xfa75368369BIOS_DPPAGE: equ 0xfaf5370BIOS_ACPAGE: equ 0xfaf6371BIOS_AVCSAV: equ 0xfaf7372BIOS_EXBRSA: equ 0xfaf8373BIOS_CHRCNT: equ 0xfaf9374BIOS_ROMA: equ 0xfafa375BIOS_MODE: equ 0xfafc376BIOS_NORUSE: equ 0xfafd377BIOS_XSAVE: equ 0xfafe378BIOS_YSAVE: equ 0xfb00379BIOS_LOGOPR: equ 0xfb02381382BIOS_RSTMP: equ 0xfb03383BIOS_TOCNT: equ 0xfb03384BIOS_RSFCB: equ 0xfb04385BIOS_RSIQLN: equ 0xfb06386BIOS_MEXBIH: equ 0xfb07387BIOS_OLDSTT: equ 0xfb0c388BIOS_OLDINT: equ 0xfb12389BIOS_DEVNUM: equ 0xfb17390BIOS_DATCNT: equ 0xfb18391BIOS_ERRORS: equ 0xfb1b392BIOS_FLAGS: equ 0xfb1c393BIOS_ESTBLS: equ 0xfb1d394BIOS_COMMSK: equ 0xfb1e395BIOS_LSTCOM: equ 0xfb1f396BIOS_LSTMOD: equ 0xfb20398399BIOS_PRSCNT: equ 0xfb35400BIOS_SAVSP: equ 0xfb36401BIOS_VOICEN: equ 0xfb38402BIOS_SAVVOL: equ 0xfb39403BIOS_MCLLEN: equ 0xfb3b404BIOS_MCLPTR: equ 0xfb3c405BIOS_QUEUEN: equ 0xfb3e406BIOS_MUSICF: equ 0xfc3f407BIOS_PLYCNT: equ 0xfb40409410BIOS_VCBA: equ 0xfb41411BIOS_VCBB: equ 0xfb66412BIOS_VCBC: equ 0xfb8b414415BIOS_ENSTOP: equ 0xfbb0416BIOS_BASROM: equ 0xfbb1417BIOS_LINTTB: equ 0xfbb2418BIOS_FSTPOS: equ 0xfbca419BIOS_CODSAV: equ 0xfbcc420BIOS_FNKSW1: equ 0xfbcd421BIOS_FNKFLG: equ 0xfbce422BIOS_ONGSBF: equ 0xfbd8423BIOS_CLIKFL: equ 0xfbd9424BIOS_OLDKEY: equ 0xfbda425BIOS_NEWKEY: equ 0xfbe5426BIOS_KEYBUF: equ 0xfbf0427BIOS_LINWRK: equ 0xfc18428BIOS_PATWRK: equ 0xfc40429BIOS_BOTTOM: equ 0xfc48430BIOS_HIMEM: equ 0xfc4a431BIOS_TRAPTBL: equ 0xfc4c432BIOS_RTYCNT: equ 0xfc9a433BIOS_INTFLG: equ 0xfc9b434BIOS_PADY: equ 0xfc9c435BIOS_PADX: equ 0xfc9d436BIOS_JIFFY: equ 0xfc9e437BIOS_INTVAL: equ 0xfca0438BIOS_INTCNT: equ 0xfca2439BIOS_LOWLIM: equ 0xfca4440BIOS_WINWID: equ 0xfca5441BIOS_GRPHED: equ 0xfca6442BIOS_ESCCNT: equ 0xfca7443BIOS_INSFLG: equ 0xfca8444BIOS_CSRSW: equ 0xfca9445BIOS_CSTYLE: equ 0xfcaa446BIOS_CAPST: equ 0xfcab447BIOS_KANAST: equ 0xfcac448BIOS_KANAMD: equ 0xfcad449BIOS_FLBMEM: equ 0xfcae450BIOS_SCRMOD: equ 0xfcaf451BIOS_OLDSCR: equ 0xfcb0452BIOS_CASPRV: equ 0xfcb1453BIOS_BRDATR: equ 0xfcb2454BIOS_GXPOS: equ 0xfcb3455BIOS_GYPOS: equ 0xfcb5456BIOS_GRPACX: equ 0xfcb7457BIOS_GRPACY: equ 0xfcb9458BIOS_DRWFLG: equ 0xfcbb459BIOS_DRWSCL: equ 0xfcbc460BIOS_DRWANG: equ 0xfcbd461BIOS_RUNBNF: equ 0xfcbe462BIOS_SAVENT: equ 0xfcbf463BIOS_ROMSLT: equ 0xfcc0464BIOS_EXPTBL: equ 0xfcc1465BIOS_SLTTBL: equ 0xfcc5466BIOS_SLTATR: equ 0xfcc9467BIOS_SLTWRK: equ 0xfd09468BIOS_PROCNM: equ 0xfd89469BIOS_DEVICE: equ 0xfd99471472BIOS_H_KEYI: equ 0xfd9a473BIOS_H_TIMI: equ 0xfd9f474BIOS_H_CHPH: equ 0xfda4475BIOS_H_DSPC: equ 0xfda9476BIOS_H_ERAC: equ 0xfdae477BIOS_H_DSPF: equ 0xfdb3478BIOS_H_ERAF: equ 0xfdb8479BIOS_H_TOTE: equ 0xfdbd480BIOS_H_CHGE: equ 0xfdc2481BIOS_H_INIP: equ 0xfdc7482BIOS_H_KEYC: equ 0xfdcc483BIOS_H_KYEA: equ 0xfdd1484BIOS_H_NMI: equ 0xfdd6485BIOS_H_PINL: equ 0xfddb486BIOS_H_QINL: equ 0xfde0487BIOS_H_INLI: equ 0xfde5488BIOS_H_ONGO: equ 0xfdea489BIOS_H_DSKO: equ 0xfdef490BIOS_H_SETS: equ 0xfdf4491BIOS_H_NAME: equ 0xfdf9492BIOS_H_KILL: equ 0xfdfe493BIOS_H_IPL: equ 0xfe03494BIOS_H_COPY: equ 0xfe08495BIOS_H_CMD: equ 0xfe0d496BIOS_H_DSKF: equ 0xfe12497BIOS_H_DSKI: equ 0xfe17498BIOS_H_ATTR: equ 0xfe1c499BIOS_H_LSET: equ 0xfe21500BIOS_H_RSET: equ 0xfe26501BIOS_H_FIEL: equ 0xfe2b502BIOS_H_MKI: equ 0xfe30503BIOS_H_MKS: equ 0xfe35504BIOS_H_MKD: equ 0xfe3a505BIOS_H_CVI: equ 0xfe3f506BIOS_H_CVS: equ 0xfe44507BIOS_H_CVD: equ 0xfe49508BIOS_H_GETP: equ 0xfe4e509BIOS_H_SETF: equ 0xfe53510BIOS_H_NOFO: equ 0xfe58511BIOS_H_NULO: equ 0xfe5d512BIOS_H_NTFL: equ 0xfe62513BIOS_H_MERG: equ 0xfe67514BIOS_H_SAVE: equ 0xfe6c515BIOS_H_BINS: equ 0xfe71516BIOS_H_BINL: equ 0xfe76517BIOS_H_FILE: equ 0xfd7b518BIOS_H_DGET: equ 0xfe80519BIOS_H_FILO: equ 0xfe85520BIOS_H_INDS: equ 0xfe8a521BIOS_H_RSLF: equ 0xfe8f522BIOS_H_SAVD: equ 0xfe94523BIOS_H_LOC: equ 0xfe99524BIOS_H_LOF: equ 0xfe9e525BIOS_H_EOF: equ 0xfea3526BIOS_H_FPOS: equ 0xfea8527BIOS_H_BAKU: equ 0xfead528BIOS_H_PARD: equ 0xfeb2529BIOS_H_NODE: equ 0xfeb7530BIOS_H_POSD: equ 0xfebc531BIOS_H_DEVN: equ 0xfec1532BIOS_H_GEND: equ 0xfec6533BIOS_H_RUNC: equ 0xfecb534BIOS_H_CLEAR: equ 0xfed0535BIOS_H_LOPD: equ 0xfed5536BIOS_H_STKE: equ 0xfeda537BIOS_H_ISFL: equ 0xfedf538BIOS_H_OUTD: equ 0xfee4539BIOS_H_CRDO: equ 0xfee9540BIOS_H_DSKC: equ 0xfeee541BIOS_H_DOGR: equ 0xfef3542BIOS_H_PRGE: equ 0xfef8543BIOS_H_ERRP: equ 0xfefd544BIOS_H_ERRF: equ 0xff02545BIOS_H_READ: equ 0xff07546BIOS_H_MAIN: equ 0xff0c547BIOS_H_DIRD: equ 0xff11548BIOS_H_FINI: equ 0xff16549BIOS_H_FINE: equ 0xff1b550BIOS_H_CRUN: equ 0xff20551BIOS_H_CRUS: equ 0xff25552BIOS_H_ISRE: equ 0xff2a553BIOS_H_NTFN: equ 0xff2f554BIOS_H_NOTR: equ 0xff34555BIOS_H_SNGF: equ 0xff39556BIOS_H_NEWS: equ 0xff3e557BIOS_H_GONE: equ 0xff43558BIOS_H_CHRG: equ 0xff48559BIOS_H_RETU: equ 0xff4d560BIOS_H_PRTF: equ 0xff52561BIOS_H_COMP: equ 0xff57562BIOS_H_FINP: equ 0xff5c563BIOS_H_TRMN: equ 0xff61564BIOS_H_FRME: equ 0xff66565BIOS_H_NTPL: equ 0xff6b566BIOS_H_EVAL: equ 0xff70567BIOS_H_OKNO: equ 0xff75568BIOS_H_FING: equ 0xff7a569BIOS_H_ISMI: equ 0xff7f570BIOS_H_WIDT: equ 0xff84571BIOS_H_LIST: equ 0xff89572BIOS_H_BUFL: equ 0xff8e573BIOS_H_FRQI: equ 0xff93574BIOS_H_SCNE: equ 0xff98575BIOS_H_FRET: equ 0xff9d576BIOS_H_PTRG: equ 0xffa2577BIOS_H_PHYD: equ 0xffa7578BIOS_H_FORM: equ 0xffac579BIOS_H_ERRO: equ 0xffb1580BIOS_H_LPTO: equ 0xffb6581BIOS_H_LPTS: equ 0xffbb582BIOS_H_SCRE: equ 0xffc0583BIOS_H_PLAY: equ 0xffc5585586BIOS_FCALL: equ 0xffca587BIOS_DISINT: equ 0xffcf588BIOS_ENAINT: equ 0xffd4592597598HKEYI: equ $fd9a 599HTIMI: equ $fd9f 601HOOK_SIZE: equ HTIMI - HKEYI604605MSXID1: equ $002b 609MSXID2: equ $002c 612MSXID3: equ $002d 617MSXID4: equ $002e 618MSXID5: equ $002f 619C:\Users\albs_\source\repos\msx-tests\pt3-player-msxlib.s10 Include/MsxConstants.s1PORT_0: equ 0x982PORT_1: equ 0x993PORT_2: equ 0x9a4PORT_3: equ 0x9b78PPI.A: equ $a8 10PPI.B: equ $a9 11PPI.C: equ $aa 17PPI.R: equ $ab 2428REG0SAV: equ 0xF3DF29REG1SAV: equ 0xF3E030REG2SAV: equ 0xF3E131REG3SAV: equ 0xF3E232REG4SAV: equ 0xF3E333REG5SAV: equ 0xF3E434REG6SAV: equ 0xF3E535REG7SAV: equ 0xF3E637REG8SAV: equ 0xFFE738REG9SAV: equ 0xFFE839REG10SAV: equ 0xFFE940REG11SAV: equ 0xFFEA41REG12SAV: equ 0xFFEB42REG13SAV: equ 0xFFEC43REG14SAV: equ 0xFFED44REG15SAV: equ 0xFFEE45REG16SAV: equ 0xFFEF46REG17SAV: equ 0xFFF047REG18SAV: equ 0xFFF148REG19SAV: equ 0xFFF249REG20SAV: equ 0xFFF350REG21SAV: equ 0xFFF451REG22SAV: equ 0xFFF552REG23SAV: equ 0xFFF65456REG25SAV: equ 0xFFFA57REG26SAV: equ 0xFFFB58REG27SAV: equ 0xFFFC59C:\Users\albs_\source\repos\msx-tests\pt3-player-msxlib.s11 Include/CommonRoutines.s14913172428SetPaletteColor:29 push bc30 31 ld b, a 32 ld c, 16 33 call BIOS_WRTVDP34 ld c, PORT_2 35 pop de37 ld a, d 38 di39 out (c), a40 ld a, e 41 ei42 out (c), a44 ret4853SetPaletteColor_FromAddress:54 55 ld b, a 56 ld c, 16 57 call BIOS_WRTVDP58 ld c, PORT_2 60 ld a, (hl) 61 di62 out (c), a63 inc hl64 ld a, (hl) 65 ei66 out (c), a68 ret7273LoadPalette:74 75 ld b, 0 76 ld c, 16 77 call BIOS_WRTVDP78 ld c, PORT_2 80 ld b, 1681.loop:82 di83 ld a, (hl)84 out (c), a85 inc hl86 ld a, (hl)87 out (c), a88 ei89 inc hl90 djnz .loop91 92 ret9697EnableRomPage2:98100 call BIOS_RSLREG101 rrca102 rrca103 and 3 104 ld c,a105 ld b,0106 ld hl, BIOS_EXPTBL107 add hl,bc108 ld a,(hl)109 and 80h110 or c111 ld c,a112 inc hl113 inc hl114 inc hl115 inc hl116 ld a,(hl)117 and 0Ch118 or c119 ld h,080h120 call BIOS_ENASLT 122 ret125129Wait_B_Vblanks:130 131 push bc132 133 .loop:135 ld a, (BIOS_JIFFY)136 ld c, a137 .waitVBlank:138 ld a, (BIOS_JIFFY)139 cp c140 jp z, .waitVBlank142 djnz .loop143 144 pop bc146 ret148Wait_15_Vblanks:149 ld c, 15151 .loop:152 ld a, (BIOS_JIFFY)153 ld b, a154 .waitVBlank:155 ld a, (BIOS_JIFFY)156 cp b157 jp z, .waitVBlank159 dec c160 jp nz, .loop162 ret164Wait_Vblank:165.loop:166 ld a, (BIOS_JIFFY)167 ld b, a168.waitVBlank:169 ld a, (BIOS_JIFFY)170 cp b171 jp z, .waitVBlank173 ret175177Wait:178 ld c, 15180 .loop:181 ld a, (BIOS_JIFFY)182 ld b, a183 .waitVBlank:184 ld a, (BIOS_JIFFY)185 cp b186 jp z, .waitVBlank188 dec c189 jp nz, .loop191195SetVdp_Write:197 206 rlc h207 rla208 rlc h209 rla210 srl h211 srl h213 di214 215 out (PORT_1), a216 ld a, 14 + 128217 out (PORT_1), a219 220 ld a, l221 nop222 out (PORT_1), a223 ld a, h224 or 64225 ei226 out (PORT_1),a227 ret229233SetVdp_Read:234 rlc h235 rla236 rlc h237 rla238 srl h239 srl h240 di241 out (PORT_1), a242 ld a, 14 + 128243 out (PORT_1), a244 ld a, l245 nop246 out (PORT_1), a247 ld a, h248 ei249 out (PORT_1), a250 ret253261282 283285287289291296304312315ClearVram_MSX2:316 xor a 317 ld hl, 0 318 call SetVDP_Write320330 xor a332 336 337 ld d, 2 338.loop_2:339 ld c, 0 340.loop_1:341 ld b, 0 342.loop:343 out (PORT_0), a344 djnz .loop345 dec c346 jp nz, .loop_1347 dec d348 jp nz, .loop_2350 ret353Screen11:354 356 ld a, 8357 call BIOS_CHGMOD359 ld a, (REG25SAV)360 or 0001 1000 b361 ld (REG25SAV), a 362 ld b, a363 364 ld c, 25 365 call BIOS_WRTVDP366 ret368SetSprites16x16:369 ld a, (REG1SAV)370 or 0000 0010 b371 ld b, a372 ld c, 1 373 call BIOS_WRTVDP374 ret376SetSpritesMagnified:377 ld a, (REG1SAV)378 or 0000 0001 b379 ld b, a380 ld c, 1 381 call BIOS_WRTVDP382 ret384Set192Lines:385 389 ld a, (REG9SAV)390 and 0111 1111 b391 ld b, a392 ld c, 9 393 call BIOS_WRTVDP394 ret396Set212Lines:397 398 ld a, (REG9SAV)399 or 1000 0000 b400 ld b, a401 ld c, 9 402 call BIOS_WRTVDP403 ret405SetNonInterlacedMode:406 407 ld a, (REG9SAV)408 and 1111 0011 b409 ld b, a410 ld c, 9 411 call BIOS_WRTVDP412 ret414SetInterlacedMode:415 416 ld a, (REG9SAV)417 or 0000 1100 b418 ld b, a419 ld c, 9 420 call BIOS_WRTVDP421 ret423SetColor0ToNonTransparent:424 429 ld a, (REG8SAV)430 or 0010 0000 b431 ld b, 0010 1000 b 432 ld c, 0x08 433 call BIOS_WRTVDP434 ret436SetColor0ToTransparent:437 438 ld a, (REG8SAV)439 and 1101 1111 b440 ld b, a441 ld c, 8 442 call BIOS_WRTVDP443 ret445DisableSprites:446 ld a, (REG8SAV)447 or 0000 0010 b448 ld b, a449 ld c, 8 450 call BIOS_WRTVDP451 ret453EnableSprites:454 ld a, (REG8SAV)455 and 1111 1101 b456 ld b, a457 ld c, 8 458 call BIOS_WRTVDP459 ret461465LDIRVM_MSX2:466 467 ex de, hl468 469 call SetVdp_Write470 ex de, hl471 ld d, c472 473 ld c, PORT_0 474 ld b, 0475.loop_1:476 otir477 dec d478 jp nz, .loop_1479 ret483501 510 514521CheckCollision_16x24_16x16:523 ld a, d 524 sub b 525 jr c, .x1IsLarger 526 sub 16 527 ret nc 528 jp .checkVerticalCollision529.x1IsLarger:530 neg 535 536 sub 16 537 ret nc 539.checkVerticalCollision:540 ld a, e 541 sub c 542 jr c, .y1IsLarger 543 sub 24 544 ret 545.y1IsLarger:546 neg 551 552 sub 16 553 ret 557562565575579582585590 591593600604606614 615623629636642645652658666668676683690693699701 703711716721725728739746751756759766771773779782784788792794797800803808 809812815 816821825828833 834837839 840845849853Execute_VDP_LMMM:854Execute_VDP_HMMM:855 ld a, 32 856 di857 out (PORT_1), a858 ld a, 17 + 128859 out (PORT_1), a860 ld c, 0x9B861.vdpReady:862 ld a, 2863 di864 out (PORT_1), a 865 ld a, 15 + 128866 out (PORT_1), a867 in a, (PORT_1)868 rra869 ld a, 0 870 out (PORT_1), a871 ld a, 15 + 128872 ei873 out (PORT_1), a 874 jp c, .vdpReady875 outi 876 outi 877 outi878 outi879 outi880 outi881 outi882 outi883 outi884 outi885 outi886 outi887 outi888 outi889 outi890 ret892896Execute_VDP_PSET:897Execute_VDP_LINE:898Execute_VDP_HMMV:899 ld a, 36 900 di901 out (PORT_1), a902 ld a, 17 + 128903 out (PORT_1), a904 ld c, 0x9B905.vdpReady:906 ld a, 2907 di908 out (PORT_1), a 909 ld a, 15 + 128910 out (PORT_1), a911 in a, (PORT_1)912 rra913 ld a, 0 914 out (PORT_1), a915 ld a, 15 + 128916 ei917 out (PORT_1), a 918 jp c, .vdpReady919 outi 920 outi 921 outi922 outi923 outi924 outi925 outi926 outi927 outi928 outi929 outi930 ret933936Execute_VDP_YMMM:937 ld a, 34 938 di939 out (PORT_1), a940 ld a, 17 + 128941 out (PORT_1), a942 ld c, 0x9B943.vdpReady:944 ld a, 2945 di946 out (PORT_1), a 947 ld a, 15 + 128948 out (PORT_1), a949 in a, (PORT_1)950 rra951 ld a, 0 952 out (PORT_1), a953 ld a, 15 + 128954 ei955 out (PORT_1), a 956 jp c, .vdpReady957 outi 958 outi 959 outi960 outi961 outi962 outi963 outi964 outi965 outi966 outi967 outi968 outi969 outi970 ret972976ReadStatusReg:977978 ld a,(0007h) 979 inc a980 ld c,a 982 out (c),b983 ld a,080h+15984 out (c),a985986 987 ld a,(0006h) 988 inc a989 ld c,a 990 in b,(c) 991 992993 ld a,(0007h) 994 inc a995 ld c,a 996 xor a997 out (c),a998 ld a,080h+15999 out (c),a1000 1002 ret10051006WRTVDP_without_DI_EI:1007 ld a, b1008 1009 out (PORT_1),a1010 ld a, c1011 or 1281012 1014 out (PORT_1), a1015 ret10191022SNSMAT_NO_DI_EI:1023 ld c, a1024.C_OK:10251026 in a, (PPI.C)1027 and 0xf0 1028 or c10291030 out (PPI.C), a1031 in a, (PPI.B)1032 ret1033C:\Users\albs_\source\repos\msx-tests\pt3-player-msxlib.s1415 include/msxlib/asm.asm12610ADD_HL_2A:11 add a121418ADD_HL_A:19 add l20 ld l, a21 ret nc22 inc h23 ret242630ADD_DE_A:31 add e32 ld e, a33 ret nc34 inc d35 ret363844GET_HL_A_BYTE:45 add l 46 ld l, a47 jr nc, .HL_OK48 inc h49.HL_OK:50 ld a, [hl] 51 ret525459GET_HL_2A_WORD:60 add a616368GET_HL_A_WORD:69 add l 70 ld l, a71 jr nc, .HL_OK72 inc h73.HL_OK:74 7781LD_HL_HL:82 ld a, [hl] 83 inc hl84 ld h, [hl]85 ld l, a86 ret878993JP_TABLE:94 add a 97101JP_TABLE_2:102 add l 103 ld l, a104 jr nc, .HL_OK105 inc h106.HL_OK:107 110114JP_HL_INDIRECT:115 ld a, [hl] 116 inc hl117 ld h, [hl]118 ld l, a119 122125JP_HL:126 jp [hl]127129132JP_IX:133 jp [ix]134136139JP_IY:140 jp [iy]141143148ADD_ARRAY_IX:149150 ld a, [ix]151 inc [ix]152153 inc ix 156162GET_ARRAY_IX:163 or a164 ret z 165 ld b, 0166.LOOP:167168 add ix, bc169 dec a170 jp nz, .LOOP171 ret172174180FOR_EACH_ARRAY_IX:181182 ld a, [ix]183 or a184 ret z 186 inc ix 187 ld b, 0188.LOOP:189 push af 190 push bc 191 push hl 192 call JP_HL193 pop hl 195.NEXT:196 pop bc 197 add ix, bc198 pop af 199 dec a200 jp nz, .LOOP201 ret202204209RET_ZERO:210 xor a211 ret212214219RET_NOT_ZERO:220 or -1221 224227RET_NO_OP:228 ret229231232C:\Users\albs_\source\repos\msx-tests\pt3-player-msxlib.s171920 CFG_HOOK_ENABLE_AUTO_KEYBOARD:2224SONG_TABLE:25 dw .PT3_Music_sample26 dw .ShuffleOne27 dw .YouWin128 dw .empty29.PT3_Music_sample:30 INCBIN "Sound/StayorGo.pt3", 10031.ShuffleOne:32 incbin "Sound/RUN23_ShuffleOne.pt3"33.YouWin1:34 incbin "Sound/RUN23_YouWin1.pt3"35.empty:36 incbin "Sound/empty.pt3"3740SOUND_BANK:41 43 5053565960 include/replayer_pt3.asm126 CFG_RAM_REPLAYER_PT3: equ 1810REPLAYER.RESET:11IFEXIST ayFX_SETUP1213 call REPLAYER.STOP1415 ld hl, SOUND_BANK16 jp ayFX_SETUP17ELSE 19ENDIF 2224REPLAYER.STOP:2526 ld a, $8127 ld [PT3_SETUP], a2829 jp PT3_MUTE303236REPLAYER.PLAY:37IFDEF CFG_PT3_PACKED3839 push af 40 call REPLAYER.STOP41 pop af 42ENDIF 4445 rlca 46 push af 47 and $fe 49IFDEF CFG_PT3_PACKED5058ELSE 60 ld hl, SONG_TABLE61 call GET_HL_A_WORD62ENDIF 64REPLAYER.PLAY_HL_OK:6566IFDEF CFG_PT3_HEADERLESS67 ld bc, -10068 add hl, bc69ENDIF7071 call PT3_INIT7273 pop af 74 and $01 75 ld [PT3_SETUP], a76 ret7779IFDEF CFG_PT3_PACKED8185REPLAYER.PLAY_UNPACKED:86 rlca 87 push af 88 jr REPLAYER.PLAY_HL_OK8991ENDIF 9395REPLAYER.FRAME:9697 call PT3_ROUT99IFEXIST ayFX_PLAY100101 call .PT3102 jp ayFX_PLAY103.PT3:104ENDIF 106108 ld a, [PT3_SETUP]109 bit 7, a 110 jp z, PT3_PLAY 112 bit 0, a 113 ret nz 115 res 7, a116 ld [PT3_SETUP], a117 jp PT3_PLAY118120122 include/PT3-ROM.tniasm.ASM1 718 2023CHNPRM_PsInOr: equ 0 24CHNPRM_PsInSm: equ 1 25CHNPRM_CrAmSl: equ 2 26CHNPRM_CrNsSl: equ 3 27CHNPRM_CrEnSl: equ 4 28CHNPRM_TSlCnt: equ 5 29CHNPRM_CrTnSl: equ 6 30CHNPRM_TnAcc: equ 8 31CHNPRM_COnOff: equ 10 34CHNPRM_OnOffD: equ 11 3637CHNPRM_OffOnD: equ 12 38CHNPRM_OrnPtr: equ 13 39CHNPRM_SamPtr: equ 15 40CHNPRM_NNtSkp: equ 17 41CHNPRM_Note: equ 18 42CHNPRM_SlToNt: equ 19 43CHNPRM_Env_En: equ 20 44CHNPRM_Flags: equ 21 46CHNPRM_TnSlDl: equ 22 47CHNPRM_TSlStp: equ 23 48CHNPRM_TnDelt: equ 25 49CHNPRM_NtSkCn: equ 27 50CHNPRM_Volume: equ 28 51CHNPRM_Size: equ 29 5455AR_TonA: equ 0 56AR_TonB: equ 2 57AR_TonC: equ 4 58AR_Noise: equ 6 59AR_Mixer: equ 7 60AR_AmplA: equ 8 61AR_AmplB: equ 9 62AR_AmplC: equ 10 63AR_Env: equ 11 64AR_EnvTp: equ 13 67 69CHECKLP: LD HL,PT3_SETUP70 SET 7,[HL]71 BIT 0,[HL]72 RET Z73 POP HL74 LD HL,DelyCnt75 INC [HL]76 LD HL,ChanA+CHNPRM_NtSkCn77 INC [HL]78PT3_MUTE: XOR A79 LD H,A80 LD L,A81 LD [AYREGS+AR_AmplA],A82 LD [AYREGS+AR_AmplB],HL83 JP ROUT_A085PT3_INIT: 86 LD [PT3_MODADDR],HL87 PUSH HL88 LD DE,10089 ADD HL,DE90 LD A,[HL]91 LD [PT3_Delay],A92 PUSH HL93 POP IX94 ADD HL,DE95 LD [PT3_CrPsPtr],HL96 LD E,[IX+102-100]97 ADD HL,DE98 INC HL99 LD [PT3_LPosPtr],HL100 POP DE101 LD L,[IX+103-100]102 LD H,[IX+104-100]103 ADD HL,DE104 LD [PT3_PatsPtr],HL105 LD HL,169106 ADD HL,DE107 LD [PT3_OrnPtrs],HL108 LD HL,105109 ADD HL,DE110 LD [PT3_SAMPTRS],HL111 LD HL,PT3_SETUP112 RES 7,[HL]114 115 ld hl,$11116 ld d,h117 ld e,h118 ld IX,VT_+16119 ld b,15120@@INITV1: push hl121 add hl,de122 ex de,hl123 sbc hl,hl124 ld c,b125 ld b,16126@@INITV2: ld a,l127 rla128 ld a,h129 adc a,0130 ld [ix],a131 inc ix132 add hl,de133 djnz @@INITV2134 pop hl135 ld a,e136 cp $77137 jr nz,@@INITV3138 inc e139@@INITV3: ld b,c140 djnz @@INITV1142 143 XOR A144 LD HL,VARS145 LD [HL],A146 LD DE,VARS+1147 LD BC,VAR0END-VARS-1148 LDIR150 INC A151 LD [DelyCnt],A152 LD HL,$F001 153 LD [ChanA+CHNPRM_NtSkCn],HL154 LD [ChanB+CHNPRM_NtSkCn],HL155 LD [ChanC+CHNPRM_NtSkCn],HL157 LD HL,EMPTYSAMORN158 LD [PT3_AdInPtA],HL 159 LD [ChanA+CHNPRM_OrnPtr],HL 160 LD [ChanB+CHNPRM_OrnPtr],HL 161 LD [ChanC+CHNPRM_OrnPtr],HL 163 LD [ChanA+CHNPRM_SamPtr],HL 164 LD [ChanB+CHNPRM_SamPtr],HL 165 LD [ChanC+CHNPRM_SamPtr],HL 167 RET169 170PD_OrSm: LD [IX+(CHNPRM_Env_En-12)],0171 CALL SETORN172 LD A,[BC]173 INC BC174 RRCA176PD_SAM: ADD A,A177PD_SAM_: LD E,A178 LD D,0179 LD HL,[PT3_SAMPTRS]180 ADD HL,DE181 LD E,[HL]182 INC HL183 LD D,[HL]184 LD HL,[PT3_MODADDR]185 ADD HL,DE186 LD [IX+(CHNPRM_SamPtr-12)],L187 LD [IX+(CHNPRM_SamPtr+1-12)],H188 JR PD_LOOP190PD_VOL: RLCA191 RLCA192 RLCA193 RLCA194 LD [IX+(CHNPRM_Volume-12)],A195 JR PD_LP2196 197PD_EOff: LD [IX+(CHNPRM_Env_En-12)],A198 LD [IX+(CHNPRM_PsInOr-12)],A199 JR PD_LP2201PD_SorE: DEC A202 JR NZ,PD_ENV203 LD A,[BC]204 INC BC205 LD [IX+(CHNPRM_NNtSkp-12)],A206 JR PD_LP2208PD_ENV: CALL SETENV209 JR PD_LP2211PD_ORN: CALL SETORN212 JR PD_LOOP213 214PD_ESAM: LD [IX+(CHNPRM_Env_En-12)],A215 LD [IX+(CHNPRM_PsInOr-12)],A216 CALL NZ,SETENV217 LD A,[BC]218 INC BC219 JR PD_SAM_221PTDECOD: LD A,[IX+(CHNPRM_Note-12)]222 LD [PT3_PrNote],A223 LD L,[IX+(CHNPRM_CrTnSl-12)]224 LD H,[IX+(CHNPRM_CrTnSl+1-12)]225 LD [PT3_PrSlide],HL227PD_LOOP: LD DE,$2010228PD_LP2: LD A,[BC]229 INC BC230 ADD A,E231 JR C,PD_OrSm232 ADD A,D233 JR Z,PD_FIN234 JR C,PD_SAM235 ADD A,E236 JR Z,PD_REL237 JR C,PD_VOL238 ADD A,E239 JR Z,PD_EOff240 JR C,PD_SorE241 ADD A,96242 JR C,PD_NOTE243 ADD A,E244 JR C,PD_ORN245 ADD A,D246 JR C,PD_NOIS247 ADD A,E248 JR C,PD_ESAM249 ADD A,A250 LD E,A251 LD HL,SPCCOMS.HL_VALUE252 ADD HL,DE253 LD E,[HL]254 INC HL255 LD D,[HL]256 PUSH DE257 JR PD_LOOP259PD_NOIS: LD [Ns_Base],A260 JR PD_LP2262PD_REL: RES 0,[IX+(CHNPRM_Flags-12)]263 JR PD_RES264 265PD_NOTE: LD [IX+(CHNPRM_Note-12)],A266 SET 0,[IX+(CHNPRM_Flags-12)]267 XOR A269PD_RES: LD [PT3_PDSP],SP270 LD SP,IX271 LD H,A272 LD L,A273 PUSH HL274 PUSH HL275 PUSH HL276 PUSH HL277 PUSH HL278 PUSH HL279 LD SP,[PT3_PDSP]281PD_FIN: LD A,[IX+(CHNPRM_NNtSkp-12)]282 LD [IX+(CHNPRM_NtSkCn-12)],A283 RET285C_PORTM: RES 2,[IX+(CHNPRM_Flags-12)]286 LD A,[BC]287 INC BC288 290 INC BC291 INC BC292 LD [IX+(CHNPRM_TnSlDl-12)],A293 LD [IX+(CHNPRM_TSlCnt-12)],A294 LD DE,NT_295 LD A,[IX+(CHNPRM_Note-12)]296 LD [IX+(CHNPRM_SlToNt-12)],A297 ADD A,A298 LD L,A299 LD H,0300 ADD HL,DE301 LD A,[HL]302 INC HL303 LD H,[HL]304 LD L,A305 PUSH HL306 LD A,[PT3_PrNote]307 LD [IX+(CHNPRM_Note-12)],A308 ADD A,A309 LD L,A310 LD H,0311 ADD HL,DE312 LD E,[HL]313 INC HL314 LD D,[HL]315 POP HL316 SBC HL,DE317 LD [IX+(CHNPRM_TnDelt-12)],L318 LD [IX+(CHNPRM_TnDelt+1-12)],H319 LD DE,[PT3_PrSlide]320 LD [IX+(CHNPRM_CrTnSl-12)],E321 LD [IX+(CHNPRM_CrTnSl+1-12)],D322 LD A,[BC] 323 INC BC324 EX AF,AF'325 LD A,[BC]326 INC BC327 AND A328 JR Z,@@NOSIG329 EX DE,HL330@@NOSIG: SBC HL,DE331 JP P,SET_STP332 CPL333 EX AF,AF'334 NEG335 EX AF,AF'336SET_STP: LD [IX+(CHNPRM_TSlStp+1-12)],A337 EX AF,AF'338 LD [IX+(CHNPRM_TSlStp-12)],A339 LD [IX+(CHNPRM_COnOff-12)],0340 RET342C_GLISS: SET 2,[IX+(CHNPRM_Flags-12)]343 LD A,[BC]344 INC BC345 LD [IX+(CHNPRM_TnSlDl-12)],A346 LD [IX+(CHNPRM_TSlCnt-12)],A347 LD A,[BC]348 INC BC349 EX AF,AF'350 LD A,[BC]351 INC BC352 JR SET_STP354C_SMPOS: LD A,[BC]355 INC BC356 LD [IX+(CHNPRM_PsInSm-12)],A357 RET359C_ORPOS: LD A,[BC]360 INC BC361 LD [IX+(CHNPRM_PsInOr-12)],A362 RET364C_VIBRT: LD A,[BC]365 INC BC366 LD [IX+(CHNPRM_OnOffD-12)],A367 LD [IX+(CHNPRM_COnOff-12)],A368 LD A,[BC]369 INC BC370 LD [IX+(CHNPRM_OffOnD-12)],A371 XOR A372 LD [IX+(CHNPRM_TSlCnt-12)],A373 LD [IX+(CHNPRM_CrTnSl-12)],A374 LD [IX+(CHNPRM_CrTnSl+1-12)],A375 RET377C_ENGLS: LD A,[BC]378 INC BC379 LD [PT3_Env_Del],A380 LD [CurEDel],A381 LD A,[BC]382 INC BC383 LD L,A384 LD A,[BC]385 INC BC386 LD H,A387 LD [PT3_ESldAdd],HL388 RET390C_DELAY: LD A,[BC]391 INC BC392 LD [PT3_Delay],A393 RET394 395SETENV: LD [IX+(CHNPRM_Env_En-12)],E396 LD [AYREGS+AR_EnvTp],A397 LD A,[BC]398 INC BC399 LD H,A400 LD A,[BC]401 INC BC402 LD L,A403 LD [EnvBase],HL404 XOR A405 LD [IX+(CHNPRM_PsInOr-12)],A406 LD [CurEDel],A407 LD H,A408 LD L,A409 LD [CurESld],HL410C_NOP: RET412SETORN: ADD A,A413 LD E,A414 LD D,0415 LD [IX+(CHNPRM_PsInOr-12)],D416 LD HL,[PT3_OrnPtrs]417 ADD HL,DE418 LD E,[HL]419 INC HL420 LD D,[HL]421 LD HL,[PT3_MODADDR]422 ADD HL,DE423 LD [IX+(CHNPRM_OrnPtr-12)],L424 LD [IX+(CHNPRM_OrnPtr+1-12)],H425 RET427 428SPCCOMS: dw C_NOP429 dw C_GLISS430 dw C_PORTM431 dw C_SMPOS432 dw C_ORPOS433 dw C_VIBRT434 dw C_NOP435 dw C_NOP436 dw C_ENGLS437 dw C_DELAY438 dw C_NOP439 dw C_NOP440 dw C_NOP441 dw C_NOP442 dw C_NOP443 dw C_NOP444.HL_VALUE: equ (SPCCOMS+$DF20) MOD 65536446CHREGS: XOR A447 LD [AYREGS+AR_AmplC],A448 BIT 0,[IX+CHNPRM_Flags]449 PUSH HL450 JP Z,@@CH_EXIT451 LD [PT3_CSP],SP452 LD L,[IX+CHNPRM_OrnPtr]453 LD H,[IX+CHNPRM_OrnPtr+1]454 LD SP,HL455 POP DE456 LD H,A457 LD A,[IX+CHNPRM_PsInOr]458 LD L,A459 ADD HL,SP460 INC A461 CP D462 JR C,@@CH_ORPS463 LD A,E464@@CH_ORPS: LD [IX+CHNPRM_PsInOr],A465 LD A,[IX+CHNPRM_Note]466 ADD A,[HL]467 JP P,@@CH_NTP468 XOR A469@@CH_NTP: CP 96470 JR C,@@CH_NOK471 LD A,95472@@CH_NOK: ADD A,A473 EX AF,AF'474 LD L,[IX+CHNPRM_SamPtr]475 LD H,[IX+CHNPRM_SamPtr+1]476 LD SP,HL477 POP DE478 LD H,0479 LD A,[IX+CHNPRM_PsInSm]480 LD B,A481 ADD A,A482 ADD A,A483 LD L,A484 ADD HL,SP485 LD SP,HL486 LD A,B487 INC A488 CP D489 JR C,@@CH_SMPS490 LD A,E491@@CH_SMPS: LD [IX+CHNPRM_PsInSm],A492 POP BC493 POP HL494 LD E,[IX+CHNPRM_TnAcc]495 LD D,[IX+CHNPRM_TnAcc+1]496 ADD HL,DE497 BIT 6,B498 JR Z,@@CH_NOAC499 LD [IX+CHNPRM_TnAcc],L500 LD [IX+CHNPRM_TnAcc+1],H501@@CH_NOAC: EX DE,HL502 EX AF,AF'503 LD L,A504 LD H,0505 LD SP,NT_506 ADD HL,SP507 LD SP,HL508 POP HL509 ADD HL,DE510 LD E,[IX+CHNPRM_CrTnSl]511 LD D,[IX+CHNPRM_CrTnSl+1]512 ADD HL,DE513 LD SP,[PT3_CSP]514 EX [SP],HL515 XOR A516 OR [IX+CHNPRM_TSlCnt]517 JR Z,@@CH_AMP518 DEC [IX+CHNPRM_TSlCnt]519 JR NZ,@@CH_AMP520 LD A,[IX+CHNPRM_TnSlDl]521 LD [IX+CHNPRM_TSlCnt],A522 LD L,[IX+CHNPRM_TSlStp]523 LD H,[IX+CHNPRM_TSlStp+1]524 LD A,H525 ADD HL,DE526 LD [IX+CHNPRM_CrTnSl],L527 LD [IX+CHNPRM_CrTnSl+1],H528 BIT 2,[IX+CHNPRM_Flags]529 JR NZ,@@CH_AMP530 LD E,[IX+CHNPRM_TnDelt]531 LD D,[IX+CHNPRM_TnDelt+1]532 AND A533 JR Z,@@CH_STPP534 EX DE,HL535@@CH_STPP: SBC HL,DE536 JP M,@@CH_AMP537 LD A,[IX+CHNPRM_SlToNt]538 LD [IX+CHNPRM_Note],A539 XOR A540 LD [IX+CHNPRM_TSlCnt],A541 LD [IX+CHNPRM_CrTnSl],A542 LD [IX+CHNPRM_CrTnSl+1],A543@@CH_AMP: LD A,[IX+CHNPRM_CrAmSl]544 BIT 7,C545 JR Z,@@CH_NOAM546 BIT 6,C547 JR Z,@@CH_AMIN548 CP 15549 JR Z,@@CH_NOAM550 INC A551 JR @@CH_SVAM552@@CH_AMIN: CP -15553 JR Z,@@CH_NOAM554 DEC A555@@CH_SVAM: LD [IX+CHNPRM_CrAmSl],A556@@CH_NOAM: LD L,A557 LD A,B558 AND 15559 ADD A,L560 JP P,@@CH_APOS561 XOR A562@@CH_APOS: CP 16563 JR C,@@CH_VOL564 LD A,15565@@CH_VOL: OR [IX+CHNPRM_Volume]566 LD L,A567 LD H,0568 LD DE,VT_569 ADD HL,DE570 LD A,[HL]571@@CH_ENV: BIT 0,C572 JR NZ,@@CH_NOEN573 OR [IX+CHNPRM_Env_En]574@@CH_NOEN: LD [AYREGS+AR_AmplC],A575 BIT 7,B576 LD A,C577 JR Z,@@NO_ENSL578 RLA579 RLA580 SRA A581 SRA A582 SRA A583 ADD A,[IX+CHNPRM_CrEnSl] 584 BIT 5,B585 JR Z,@@NO_ENAC586 LD [IX+CHNPRM_CrEnSl],A587@@NO_ENAC: LD HL,PT3_AddToEn588 ADD A,[HL] 590 LD [HL],A591 JR @@CH_MIX592@@NO_ENSL: RRA593 ADD A,[IX+CHNPRM_CrNsSl]594 LD [AddToNs],A595 BIT 5,B596 JR Z,@@CH_MIX597 LD [IX+CHNPRM_CrNsSl],A598@@CH_MIX: LD A,B599 RRA600 AND $48601@@CH_EXIT: LD HL,AYREGS+AR_Mixer602 OR [HL]603 RRCA604 LD [HL],A605 POP HL606 XOR A607 OR [IX+CHNPRM_COnOff]608 RET Z609 DEC [IX+CHNPRM_COnOff]610 RET NZ611 XOR [IX+CHNPRM_Flags]612 LD [IX+CHNPRM_Flags],A613 RRA614 LD A,[IX+CHNPRM_OnOffD]615 JR C,@@CH_ONDL616 LD A,[IX+CHNPRM_OffOnD]617@@CH_ONDL: LD [IX+CHNPRM_COnOff],A618 RET620PT3_PLAY: XOR A621 LD [PT3_AddToEn],A622 LD [AYREGS+AR_Mixer],A623 DEC A624 LD [AYREGS+AR_EnvTp],A625 LD HL,DelyCnt626 DEC [HL]627 JP NZ,@@PL2628 LD HL,ChanA+CHNPRM_NtSkCn629 DEC [HL]630 JR NZ,@@PL1B631 LD BC,[PT3_AdInPtA]632 LD A,[BC]633 AND A634 JR NZ,@@PL1A635 LD D,A636 LD [Ns_Base],A637 LD HL,[PT3_CrPsPtr]638 INC HL639 LD A,[HL]640 INC A641 JR NZ,@@PLNLP642 CALL CHECKLP643 LD HL,[PT3_LPosPtr]644 LD A,[HL]645 INC A646@@PLNLP: LD [PT3_CrPsPtr],HL647 DEC A648 ADD A,A649 LD E,A650 RL D651 LD HL,[PT3_PatsPtr]652 ADD HL,DE653 LD DE,[PT3_MODADDR]654 LD [PT3_PSP],SP655 LD SP,HL656 POP HL657 ADD HL,DE658 LD B,H659 LD C,L660 POP HL661 ADD HL,DE662 LD [PT3_AdInPtB],HL663 POP HL664 ADD HL,DE665 LD [PT3_AdInPtC],HL666 LD SP,[PT3_PSP]668@@PL1A: LD IX,ChanA+12669 CALL PTDECOD670 LD [PT3_AdInPtA],BC672@@PL1B: LD HL,ChanB+CHNPRM_NtSkCn673 DEC [HL]674 JR NZ,@@PL1C675 LD IX,ChanB+12676 LD BC,[PT3_AdInPtB]677 CALL PTDECOD678 LD [PT3_AdInPtB],BC680@@PL1C: LD HL,ChanC+CHNPRM_NtSkCn681 DEC [HL]682 JR NZ,@@PL1D683 LD IX,ChanC+12684 LD BC,[PT3_AdInPtC]685 CALL PTDECOD686 LD [PT3_AdInPtC],BC688@@PL1D: LD A,[PT3_Delay]689 LD [DelyCnt],A691@@PL2: LD IX,ChanA692 LD HL,[AYREGS+AR_TonA]693 CALL CHREGS694 LD [AYREGS+AR_TonA],HL695 LD A,[AYREGS+AR_AmplC]696 LD [AYREGS+AR_AmplA],A697 LD IX,ChanB698 LD HL,[AYREGS+AR_TonB]699 CALL CHREGS700 LD [AYREGS+AR_TonB],HL701 LD A,[AYREGS+AR_AmplC]702 LD [AYREGS+AR_AmplB],A703 LD IX,ChanC704 LD HL,[AYREGS+AR_TonC]705 CALL CHREGS706 LD [AYREGS+AR_TonC],HL708 LD HL,[Ns_Base_AddToNs]709 LD A,H710 ADD A,L711 LD [AYREGS+AR_Noise],A713 LD A,[PT3_AddToEn]714 LD E,A715 ADD A,A716 SBC A,A717 LD D,A718 LD HL,[EnvBase]719 ADD HL,DE720 LD DE,[CurESld]721 ADD HL,DE722 LD [AYREGS+AR_Env],HL724 XOR A725 LD HL,CurEDel726 OR [HL]727 RET Z728 DEC [HL]729 RET NZ730 LD A,[PT3_Env_Del]731 LD [HL],A732 LD HL,[PT3_ESldAdd]733 ADD HL,DE734 LD [CurESld],HL735 RET737PT3_ROUT: XOR A738 739ROUT_A0: 740 LD HL,AYREGS+AR_Mixer741 set 7,[hl]742 res 6,[hl]744 LD C,$A0745 LD HL,AYREGS746@@LOUT: OUT [C],A747 INC C748 OUTI 749 DEC C750 INC A751 CP 13752 JR NZ,@@LOUT753 OUT [C],A754 LD A,[HL]755 AND A756 RET M757 INC C758 OUT [C],A759 RET761EMPTYSAMORN: db 0,1,0,$90 763NT_: 766 dw $0D10,$0C55,$0BA4,$0AFC,$0A5F,$09CA,$093D,$08B8,$083B,$07C5,$0755,$06EC767 dw $0688,$062A,$05D2,$057E,$052F,$04E5,$049E,$045C,$041D,$03E2,$03AB,$0376768 dw $0344,$0315,$02E9,$02BF,$0298,$0272,$024F,$022E,$020F,$01F1,$01D5,$01BB769 dw $01A2,$018B,$0174,$0160,$014C,$0139,$0128,$0117,$0107,$00F9,$00EB,$00DD770 dw $00D1,$00C5,$00BA,$00B0,$00A6,$009D,$0094,$008C,$0084,$007C,$0075,$006F771 dw $0069,$0063,$005D,$0058,$0053,$004E,$004A,$0046,$0042,$003E,$003B,$0037772 dw $0034,$0031,$002F,$002C,$0029,$0027,$0025,$0023,$0021,$001F,$001D,$001C773 dw $001A,$0019,$0017,$0016,$0015,$0014,$0012,$0011,$0010,$000F,$000E,$000D774include/replayer_pt3.asm123126127C:\Users\albs_\source\repos\msx-tests\pt3-player-msxlib.s6263 include/ayFX-ROM.tniasm.asm1 3 CFG_REPLAYER_AYFX: equ 15 15ayFX_SETUP: 17 ld [ayFX_BANK],hl 18 xor a 19 ld [ayFX_MODE],a 20 inc a 21 ld [ayFX_CHANNEL],a 22ayFX_END: 23 ld a,255 24 ld [ayFX_PRIORITY],a 25 ret 27ayFX_INIT: 30 push bc 31 push de 32 push hl 34 ld b,a 35 ld hl,[ayFX_BANK] 36 ld a,[hl] 37 or a 38 jr z,@@CHECK_PRI 40 ld a,b 41 cp [hl] 42 ld a,2 43 jr nc,@@INIT_END 44@@CHECK_PRI: 47 ld a,[ayFX_PRIORITY] 48 cp c 49 ld a,1 50 jr c,@@INIT_END 52 ld a,c 53 and $0F 54 ld [ayFX_PRIORITY],a 56 IFDEF CFG_AYFX_RELATIVE57 58 ld c,a 59 ld a,15 60 sub c 61 jr z,@@INIT_NOSOUND 62 add a,a 63 add a,a 64 add a,a 65 add a,a 66 ld e,a 67 ld d,0 68 ld hl,VT_ 69 add hl,de 70 ld [ayFX_VT],hl 71 ENDIF 73 74 ld de,[ayFX_BANK] 75 inc de 76 ld l,b 77 ld h,0 78 add hl,hl 79 add hl,de 80 ld e,[hl] 81 inc hl 82 ld d,[hl] 83 add hl,de 84 ld [ayFX_POINTER],hl 85 xor a 86@@INIT_END: pop hl 87 pop de 88 pop bc 89 ret 91 IFDEF CFG_AYFX_RELATIVE92 @@INIT_NOSOUND: 93 ld a,255 94 ld [ayFX_PRIORITY],a 95 jr @@INIT_END 96 ENDIF 98ayFX_PLAY: 99 ld a,[ayFX_PRIORITY] 100 or a 101 ret m 103 ld a,[ayFX_MODE] 104 and 1 105 jr z,@@TAKECB 106 ld hl,ayFX_CHANNEL 107 dec [hl] 108 jr nz,@@TAKECB 109 ld [hl],3 110@@TAKECB: 111 ld hl,[ayFX_POINTER] 112 ld c,[hl] 113 inc hl 115 bit 5,c 116 jr z,@@CHECK_NN 118 ld e,[hl] 119 inc hl 120 ld d,[hl] 121 inc hl 122 ld [ayFX_TONE],de 123@@CHECK_NN: 124 bit 6,c 125 jr z,@@SETPOINTER 127 ld a,[hl] 128 inc hl 129 cp $20 130 jr z,ayFX_END 131 ld [ayFX_NOISE],a 132@@SETPOINTER: 133 ld [ayFX_POINTER],hl 135 ld a,c 136 and $0F 138 IFDEF CFG_AYFX_RELATIVE139 140 ld hl,[ayFX_VT] 141 ld e,a 142 ld d,0 143 add hl,de 144 ld a,[hl] 145 or a 146 ENDIF 148 ld [ayFX_VOLUME],a 149 ret z 154 bit 7,c 155 jr nz,@@SETMASKS 156 ld a,[ayFX_NOISE] 157 ld [AYREGS+6],a 158@@SETMASKS: 159 ld a,c 160 and $90 161 cp $90 162 ret z 164 rrca 165 rrca 166 ld d,$DB 168 ld hl,ayFX_CHANNEL 169 ld b,[hl] 170@@CHK1: 171 djnz @@CHK2 172@@PLAY_C: 173 call @@SETMIXER 174 ld [AYREGS+10],a 175 bit 2,c 176 ret nz 177 ld [AYREGS+4],hl 178 ret 179@@CHK2: 180 rrc d 181 rrca 182 djnz @@CHK3 183@@PLAY_B: 184 call @@SETMIXER 185 ld [AYREGS+9],a 186 bit 1,c 187 ret nz 188 ld [AYREGS+2],hl 189 ret 190@@CHK3: 191 rrc d 192 rrca 193@@PLAY_A: 194 call @@SETMIXER 195 ld [AYREGS+8],a 196 bit 0,c 197 ret nz 198 ld [AYREGS+0],hl 199 ret 200@@SETMIXER: 201 ld c,a 202 ld a,[AYREGS+7] 203 and d 204 or c 205 ld [AYREGS+7],a 206 ld a,[ayFX_VOLUME] 207 ld hl,[ayFX_TONE] 208 ret 210 IFDEF CFG_AYFX_RELATIVE211 214 ENDIF 215C:\Users\albs_\source\repos\msx-tests\pt3-player-msxlib.s6468748082 ld a, $80 + 083 call REPLAYER.PLAY8692Execute:94 97 call BIOS_INITXT100.loop:102 103 ld a, (BIOS_JIFFY)104 ld b, a105.waitVBlank:106 ld a, (BIOS_JIFFY)107 cp b108 jp z, .waitVBlank110113 ld a, 5 114 cp 5115 jr z, .NO_FRAMESKIP 118 ld hl, replayer.frameskip119 inc [hl]120 sub [hl]121 jr nz, .NO_FRAMESKIP 124 ld [hl], a125 jr .FRAMESKIP127.NO_FRAMESKIP:128129 call REPLAYER.FRAME130.FRAMESKIP:131133 136 ld hl, Debug_Message137 call PrintString139 jp .loop142PrintString:143 ld a, (hl)144 cp 0145 ret z146 call BIOS_CHPUT147 inc hl148 jr PrintString150Debug_Message:151 db "Test message", 13, 10, 0153 db "End ROM started at 0x4000"155 ds PageSize - ($ - 0x4000), 255 159160 org 0xc000, 0xe5ff162167 include/PT3-RAM.tniasm.asm1 3 5PT3_SETUP: rb 1 7PT3_MODADDR: rb 28PT3_CrPsPtr: rb 29PT3_SAMPTRS: rb 210PT3_OrnPtrs: rb 211PT3_PDSP: rb 212PT3_CSP: rb 213PT3_PSP: rb 214PT3_PrNote: rb 115PT3_PrSlide: rb 216PT3_AdInPtA: rb 217PT3_AdInPtB: rb 218PT3_AdInPtC: rb 219PT3_LPosPtr: rb 220PT3_PatsPtr: rb 221PT3_Delay: rb 122PT3_AddToEn: rb 123PT3_Env_Del: rb 124PT3_ESldAdd: rb 226VARS:28ChanA: rb 29 29ChanB: rb 29 30ChanC: rb 29 3233DelyCnt: rb 134CurESld: rb 235CurEDel: rb 136Ns_Base_AddToNs:37Ns_Base: rb 138AddToNs: rb 140AYREGS:41VT_: rb 1442EnvBase: rb 243VAR0END: rb 24044C:\Users\albs_\source\repos\msx-tests\pt3-player-msxlib.s169 include/ayFX-RAM.tniasm.asm1 3 5ayFX_MODE: rb 1 6ayFX_BANK: rw 1 7ayFX_PRIORITY: rb 1 8ayFX_POINTER: rw 1 9ayFX_TONE: rw 1 10ayFX_NOISE: rb 1 11ayFX_VOLUME: rb 1 12ayFX_CHANNEL: rb 1 13IFDEF CFG_AYFX_RELATIVE14 ayFX_VT: rw 1 15ENDIF 17 20C:\Users\albs_\source\repos\msx-tests\pt3-player-msxlib.s171172replayer.frameskip:173 rb 1