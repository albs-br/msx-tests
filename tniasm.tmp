v9990_p1_test.s1FNAME "v9990_p1_test.rom" 3PageSize: equ 0x4000 56 org 0x4000, 0xbeff 8 Include/RomHeader.s12 db "AB" 3 dw Execute 4 dw 0 6 dw 0 8 dw 0 9 dw 0, 0, 0 10 11v9990_p1_test.s9 Include/V9990.s13V9:5820.PORT_0: equ 0x6021.PORT_1: equ 0x6122.PORT_2: equ 0x6223.PORT_3: equ 0x6324.PORT_4: equ 0x6425.PORT_5: equ 0x6526.PORT_6: equ 0x6627.PORT_7: equ 0x6728323940.P1_PATTBL_LAYER_A: equ 0x00000 41.P1_PATTBL_LAYER_B: equ 0X40000 42.P1_SPRATR: equ 0X3fe00 43.P1_NAMTBL_LAYER_A: equ 0X7c000 44.P1_NAMTBL_LAYER_B: equ 0X7e000 46485051.SetRegister:52 di53 out (V9.PORT_4), a 54 ld a, b55 ei56 out (V9.PORT_3), a 57 ret60626465.ReadRegister:66 di67 out (V9.PORT_4), a 68 ei69 in a, (V9.PORT_3) 70 ret737576.SetVdp_Write:77 ld b, a 79 80 xor a 81 di82 out (V9.PORT_4), a84 ld c, V9.PORT_386 87 out (c), e89 90 out (c), d92 93 and 0111 1111 b 94 ei95 out (c), b97 ret99102107.LDIRVM:108 115 117 120 124 129 push bc130 call .SetVdp_Write131 pop de133 ld c, V9.PORT_0134.LDIRVM_loop:135 136 outi137 138 dec de139 ld a, e140 or d141 jp nz, .LDIRVM_loop143 ret146149.SetTilePattern:150 ld b, 8151.SetTilePattern_loop:152 push af, bc153 call V9.SetVdp_Write155 ld c, (V9.PORT_0)157 outi outi outi outi 159 ex de, hl160 ld bc, 0x80 161 add hl, bc162 ex de, hl164 pop bc, af165 djnz .SetTilePattern_loop167 ret169171.ClearVRAM:172 xor a173 ld de, 0174 call V9.SetVdp_Write176 177 ld bc, 0 178.ClearVRAM_loop:179 xor a180 181 out (v9.PORT_0), a182 out (v9.PORT_0), a183 out (v9.PORT_0), a184 out (v9.PORT_0), a185 out (v9.PORT_0), a186 out (v9.PORT_0), a187 out (v9.PORT_0), a188 out (v9.PORT_0), a190 dec bc191 ld a, b192 or c193 jp nz, .ClearVRAM_loop195 ret197199.Mode_P1:200 202 203 xor a204 out (V9.PORT_7), a206 210 ld a, 6 211 ld b, 0000 0101 b 212 call V9.SetRegister214 222 ld a, 7 223 ld b, 0000 0000 b 224 call V9.SetRegister227 229 ld a, 8 230 ld b, 1000 0010 b 231 call V9.SetRegister234 235 ld a, 27 236 ld b, 0000 0000 b 237 call V9.SetRegister239 ret242245248 249252255 260.SetScroll_Layer_A:262 263 ld a, 17 264 ld b, e 265 call V9.SetRegister267 269 270 ld a, 18 271 ld b, d 272 call V9.SetRegister275 277 278 ld a, 19 279 ld b, 0 280 call V9.SetRegister282 283 ld a, 20 284 ld b, 0 285 call V9.SetRegister287 ret289 294.SetScroll_Layer_B:296 298 ld a, 21 299 ld b, 0000 0000 b 300 call V9.SetRegister302 ld a, 22 303 ld b, 0000 0000 b 304 call V9.SetRegister306 ld a, 23 307 ld b, 0000 0000 b 308 call V9.SetRegister310 ld a, 24 311 ld b, 0000 0000 b 312 call V9.SetRegister314 ret316318321.SetPaletteControlRegister:323 sla b 324 sla b326 or b327 ld b, a329 330 331 333 337 341 342 348 ld a, 13 349 call V9.SetRegister351 ret354357360.LoadPalette:362 ld c, a363 364 365 ld a, 0000 1110 b366 out (V9.PORT_4), a368 ld a, c370 sla a 371 sla a372 sla a373 sla a374 sla a375 sla a377 378 379 382 out (V9.PORT_3), a384 388 ld c, V9.PORT_1389 392 outi outi outi outi outi outi outi outi 393 outi outi outi outi outi outi outi outi 394 outi outi outi outi outi outi outi outi 395 outi outi outi outi outi outi outi outi 396 outi outi outi outi outi outi outi outi 397 outi outi outi outi outi outi outi outi 399 ret401402v9990_p1_test.s12Execute:14 call V9.Mode_P118 19 ld hl, 0 20 ld de, 0 21 call V9.SetScroll_Layer_A23 24 ld hl, 0 25 ld de, 0 26 call V9.SetScroll_Layer_B30 call V9.ClearVRAM34 36 37 ld hl, Tile_Empty 38 ld a, V9.P1_PATTBL_LAYER_A >> 16 39 ld de, V9.P1_PATTBL_LAYER_A AND 0xffff 40 call V9.SetTilePattern42 43 ld hl, Tile_0 44 ld a, 0 + (V9.P1_PATTBL_LAYER_A + 4) >> 16 45 ld de, 0 + (V9.P1_PATTBL_LAYER_A + 4) AND 0xffff 46 call V9.SetTilePattern48 49 ld hl, Tile_1 50 ld a, 0 + (V9.P1_PATTBL_LAYER_A + 0x00400) >> 16 51 ld de, 0 + (V9.P1_PATTBL_LAYER_A + 0x00400) AND 0xffff 52 call V9.SetTilePattern56 58 59 ld hl, Tile_Empty 60 ld a, V9.P1_PATTBL_LAYER_B >> 16 61 ld de, V9.P1_PATTBL_LAYER_B AND 0xffff 62 call V9.SetTilePattern64 65 ld hl, Tile_0 66 ld a, 0 + (V9.P1_PATTBL_LAYER_B + 4) >> 16 67 ld de, 0 + (V9.P1_PATTBL_LAYER_B + 4) AND 0xffff 68 call V9.SetTilePattern70 71 ld hl, Tile_1 72 ld a, 0 + (V9.P1_PATTBL_LAYER_B + 0x00400) >> 16 73 ld de, 0 + (V9.P1_PATTBL_LAYER_B + 0x00400) AND 0xffff 74 call V9.SetTilePattern77 78 ld hl, NamesTable_test 79 ld a, V9.P1_NAMTBL_LAYER_A >> 16 80 ld de, V9.P1_NAMTBL_LAYER_A AND 0xffff 81 ld bc, NamesTable_test.size 82 call V9.LDIRVM 84 85 ld hl, NamesTable_B_test 86 ld a, V9.P1_NAMTBL_LAYER_B >> 16 87 ld de, V9.P1_NAMTBL_LAYER_B AND 0xffff 88 ld bc, NamesTable_B_test.size 89 call V9.LDIRVM 93 ld a, 0 94 ld b, 1 95 call V9.SetPaletteControlRegister99 ld a, 0100 ld hl, Palette_test_0101 call V9.LoadPalette103 ld a, 1104 ld hl, Palette_test_1105 call V9.LoadPalette107 ld a, 2108 ld hl, Palette_test_2109 call V9.LoadPalette111 ld a, 3112 ld hl, Palette_test_3113 call V9.LoadPalette117 118 119 jp $ 122124128132135137147150152154Tile_Empty:155 db 0x00, 0x00, 0x00, 0x00156 db 0x00, 0x00, 0x00, 0x00157 db 0x00, 0x00, 0x00, 0x00158 db 0x00, 0x00, 0x00, 0x00159 db 0x00, 0x00, 0x00, 0x00160 db 0x00, 0x00, 0x00, 0x00161 db 0x00, 0x00, 0x00, 0x00162 db 0x00, 0x00, 0x00, 0x00163.size: equ $ - Tile_Empty165Tile_0:166 db 0x1f, 0xff, 0xff, 0xff167 db 0x20, 0x00, 0x00, 0xff168 db 0x30, 0x00, 0x0f, 0x0f169 db 0x40, 0x00, 0xf0, 0x0f170 db 0x50, 0x0f, 0x00, 0x0f171 db 0x60, 0xf0, 0x00, 0x0f172 db 0x7f, 0x00, 0x00, 0x0f173 db 0x8f, 0xff, 0xff, 0xff174.size: equ $ - Tile_0176Tile_1:177 db 0x00, 0x11, 0x22, 0x33178 db 0x00, 0x11, 0x22, 0x33179 db 0x44, 0x55, 0x66, 0x77180 db 0x44, 0x55, 0x66, 0x77181 db 0x88, 0x99, 0xaa, 0xbb182 db 0x88, 0x99, 0xaa, 0xbb183 db 0xcc, 0xdd, 0xee, 0xff184 db 0xcc, 0xdd, 0xee, 0xff185.size: equ $ - Tile_Empty187189NamesTable_test:190 dw 0, 1, 0,32, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1191 dw 1, 0, 0,32, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1192.size: equ $ - NamesTable_test194NamesTable_B_test:195 198 dw 1, 1, 1, 0,32, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0199 dw 1, 1,32, 0,32, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0200 dw 1,32,32, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0201.size: equ $ - NamesTable_B_test203205Palette_test_0:206 207 db 0, 0, 0208 db 15, 0, 0209 db 15, 31, 31210 db 15, 0, 31212 db 0, 0, 15213 db 31, 0, 0214 db 0, 31, 0215 db 0, 0, 31217 db 31, 15, 15218 db 15, 31, 15219 db 15, 15, 31220 db 15, 0, 0222 db 0, 15, 0223 db 0, 0, 15224 226 db 6, 5, 4227 db 31, 31, 31229Palette_test_1:230 231 db 0, 0, 0232 db 2, 2, 2233 db 4, 4, 4234 db 6, 6, 6236 db 8, 8, 8237 db 10, 10, 10238 db 12, 12, 12239 db 14, 14, 14241 db 16, 16, 16242 db 18, 18, 18243 db 20, 20, 20244 db 22, 22, 22246 db 24, 24, 24247 db 26, 26, 26248 db 28, 28, 28249 db 31, 31, 31251Palette_test_2:252 253 db 0, 0, 0254 db 2, 2, 0255 db 4, 4, 0256 db 6, 6, 0258 db 8, 8, 0259 db 10, 10, 0260 db 12, 12, 0261 db 14, 14, 0263 db 16, 16, 0264 db 18, 18, 0265 db 20, 20, 0266 db 22, 22, 0268 db 24, 24, 0269 db 26, 26, 0270 db 28, 28, 0271 db 31, 31, 0273Palette_test_3:274 275 db 0, 0, 0276 db 2, 0, 0277 db 4, 0, 0278 db 6, 0, 0280 db 8, 0, 0281 db 10, 0, 0282 db 12, 0, 0283 db 14, 0, 0285 db 16, 0, 0286 db 18, 0, 0287 db 20, 0, 0288 db 22, 0, 0290 db 24, 0, 0291 db 26, 0, 0292 db 28, 0, 0293 db 31, 0, 0295297SPRATR_Table_Test:298 307 db 106, 0, 128, 00 0 0 0 0 00 b308.size: equ $ - SPRATR_Table_Test310312313SpritePattern_Test_1:314 db 0x11, 0x11, 0x88, 0x77, 0x66, 0x55, 0x44, 0x33315 db 0x22, 0x22, 0x88, 0x77, 0x66, 0x55, 0x44, 0x33316 db 0x11, 0x11, 0x88, 0x77, 0x66, 0x55, 0x44, 0x33317 db 0x22, 0x22, 0x88, 0x77, 0x66, 0x55, 0x44, 0x33319 db 0x11, 0x11, 0xee, 0xdd, 0xcc, 0xbb, 0xaa, 0x99320 db 0x22, 0x22, 0xee, 0xdd, 0xcc, 0xbb, 0xaa, 0x99321 db 0x11, 0x11, 0xee, 0xdd, 0xcc, 0xbb, 0xaa, 0x99322 db 0x22, 0x22, 0xee, 0xdd, 0xcc, 0xbb, 0xaa, 0x99324 db 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f325 db 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f326 db 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f327 db 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f329 db 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f330 db 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f331 db 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f332 db 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff333.size: equ $ - SpritePattern_Test_1335336 ds PageSize - ($ - 0x4000), 255 337