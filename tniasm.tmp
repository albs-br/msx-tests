c:\Users\albs_\source\repos\msx-tests\v9990_p1_test.s1FNAME "v9990_p1_test.rom" 3PageSize: equ 0x4000 56 org 0x4000, 0xbeff 8 Include/RomHeader.s12 db "AB" 3 dw Execute 4 dw 0 6 dw 0 8 dw 0 9 dw 0, 0, 0 10 11c:\Users\albs_\source\repos\msx-tests\v9990_p1_test.s9 Include/V9990.s13V9:5820.PORT_0: equ 0x6021.PORT_1: equ 0x6122.PORT_2: equ 0x6223.PORT_3: equ 0x6324.PORT_4: equ 0x6425.PORT_5: equ 0x6526.PORT_6: equ 0x6627.PORT_7: equ 0x6728323940.P1_PATTBL_LAYER_A: equ 0x00000 41.P1_PATTBL_LAYER_B: equ 0X40000 42.P1_SPRATR: equ 0X3fe00 43.P1_NAMTBL_LAYER_A: equ 0X7c000 44.P1_NAMTBL_LAYER_B: equ 0X7e000 46485051.SetRegister:52 out (V9.PORT_4), a 53 ld a, b54 out (V9.PORT_3), a 55 ret5960.SetVdp_Write:61 ld b, a 63 64 ld a, 0000 0000 b65 di66 out (V9.PORT_4), a68 ld c, V9.PORT_370 71 out (c), e73 74 out (c), d76 77 and 0111 1111 b 78 ei79 out (c), b81 ret8590.LDIRVM:91 92 push bc93 push af94 95 ld a, 0000 0000 B96 out (V9.PORT_4), a98 ld c, V9.PORT_3100 101 out (c), e103 104 out (c), d105 pop af107 108 and 0111 1111 b 109 out (c), a110 pop de112 ld c, V9.PORT_0113.LDIRVM_loop:114 115 outi116 117 dec de118 ld a, e119 or d120 jp nz, .LDIRVM_loop122 ret125128.SetTilePattern:129 ld b, 8130.SetTilePattern_loop:131 push af, bc132 call V9.SetVdp_Write134 ld c, (V9.PORT_0)136 outi outi outi outi 138 ex de, hl139 ld bc, 0x80 140 add hl, bc141 ex de, hl143 pop bc, af144 djnz .SetTilePattern_loop146 ret148150.ClearVRAM:151 xor a152 ld de, 0153 call V9.SetVdp_Write155 156 ld bc, 65535 157 ld d, 0158.ClearVRAM_loop:159 xor a160 161 out (v9.PORT_0), a162 out (v9.PORT_0), a163 out (v9.PORT_0), a164 out (v9.PORT_0), a165 out (v9.PORT_0), a166 out (v9.PORT_0), a167 out (v9.PORT_0), a168 out (v9.PORT_0), a170 dec bc171 ld a, b172 or c173 jp nz, .ClearVRAM_loop175 retc:\Users\albs_\source\repos\msx-tests\v9990_p1_test.s12Execute:14 16 17 ld a, 018 out (V9.PORT_7), a20 24 ld a, 6 25 ld b, 0000 0101 b 26 call V9.SetRegister28 36 ld a, 7 37 ld b, 0000 0000 b 38 call V9.SetRegister41 43 ld a, 8 44 ld b, 1000 0010 b 45 call V9.SetRegister48 49 ld a, 27 50 ld b, 0000 0000 b 51 call V9.SetRegister55 56 ld a, 17 57 ld b, 0000 0000 b 58 call V9.SetRegister60 ld a, 18 61 ld b, 0000 0000 b 62 call V9.SetRegister64 ld a, 19 65 ld b, 0000 0000 b 66 call V9.SetRegister68 ld a, 20 69 ld b, 0000 0000 b 70 call V9.SetRegister72 ld a, 21 73 ld b, 0000 0000 b 74 call V9.SetRegister76 ld a, 22 77 ld b, 0000 0000 b 78 call V9.SetRegister80 ld a, 23 81 ld b, 0000 0000 b 82 call V9.SetRegister84 ld a, 24 85 ld b, 0000 0000 b 86 call V9.SetRegister90 call V9.ClearVRAM94 101 ld hl, Tile_Empty 102 ld a, V9.P1_PATTBL_LAYER_A >> 16 103 ld de, V9.P1_PATTBL_LAYER_A AND 0xffff 104 call V9.SetTilePattern106 ld hl, Tile_0 107 ld a, 0 + (V9.P1_PATTBL_LAYER_A + 4) >> 16 108 ld de, 0 + (V9.P1_PATTBL_LAYER_A + 4) AND 0xffff 109 call V9.SetTilePattern113 115 ld hl, Tile_Empty 116 ld a, V9.P1_PATTBL_LAYER_B >> 16 117 ld de, V9.P1_PATTBL_LAYER_B AND 0xffff 118 call V9.SetTilePattern122 123 ld hl, NamesTable_test 124 ld a, V9.P1_NAMTBL_LAYER_A >> 16 125 ld de, V9.P1_NAMTBL_LAYER_A AND 0xffff 126 ld bc, NamesTable_test.size 127 call V9.LDIRVM 129 130 ld hl, NamesTable_B_test 131 ld a, V9.P1_NAMTBL_LAYER_B >> 16 132 ld de, V9.P1_NAMTBL_LAYER_B AND 0xffff 133 ld bc, NamesTable_B_test.size 134 call V9.LDIRVM 136 137 138 142 146 ld a, 13 147 ld b, 0000 00 00 b 148 call V9.SetRegister151 153 154 ld a, 0000 1110 b155 out (V9.PORT_4), a157 158 ld a, 0000 0000 b159 out (V9.PORT_3), a161 164 ld hl, Palette_test165 ld c, V9.PORT_1166 ld b, 16 * 3 167.SetPalette_loop:168 outi 169 outi 170 outi 171 djnz .SetPalette_loop173 jp $ 176178182186189191201203205207Tile_0:208 db 0x1f, 0xff, 0xff, 0xff209 db 0x20, 0x00, 0x00, 0xff210 db 0x30, 0x00, 0x0f, 0x0f211 db 0x40, 0x00, 0xf0, 0x0f212 db 0x50, 0x0f, 0x00, 0x0f213 db 0x60, 0xf0, 0x00, 0x0f214 db 0x7f, 0x00, 0x00, 0x0f215 db 0x8f, 0xff, 0xff, 0xff216.size: equ $ - Tile_0218Tile_Empty:219 db 0x00, 0x00, 0x00, 0x00220 db 0x00, 0x00, 0x00, 0x00221 db 0x00, 0x00, 0x00, 0x00222 db 0x00, 0x00, 0x00, 0x00223 db 0x00, 0x00, 0x00, 0x00224 db 0x00, 0x00, 0x00, 0x00225 db 0x00, 0x00, 0x00, 0x00226 db 0x00, 0x00, 0x00, 0x00227.size: equ $ - Tile_Empty229NamesTable_test:230 dw 0x0000, 0x0001, 0, 1, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1231 dw 0x0001, 0x0000, 0, 1, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1232 255.size: equ $ - NamesTable_test257NamesTable_B_test:258 dw 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0259.size: equ $ - NamesTable_B_test261Palette_test:262 263 db 15, 0, 0264 db 15, 31, 31265 db 15, 0, 31266 db 15, 15, 15268 db 0, 0, 0269 db 31, 0, 0270 db 0, 31, 0271 db 0, 0, 31273 db 31, 15, 15274 db 15, 31, 15275 db 15, 15, 31276 db 15, 0, 0278 db 0, 15, 0279 db 0, 0, 15280 db 0, 7, 0281 db 0, 0, 7285286 ds PageSize - ($ - 0x4000), 255 287