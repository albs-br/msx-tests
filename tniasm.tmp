c:\Users\albs_\source\repos\msx-tests\v9990_p1_test.s1FNAME "v9990_p1_test.rom" 3PageSize: equ 0x4000 56 org 0x4000, 0xbeff 8 Include/RomHeader.s12 db "AB" 3 dw Execute 4 dw 0 6 dw 0 8 dw 0 9 dw 0, 0, 0 10 11c:\Users\albs_\source\repos\msx-tests\v9990_p1_test.s9 Include/V9990.s13V9:5820.PORT_0: equ 0x6021.PORT_1: equ 0x6122.PORT_2: equ 0x6223.PORT_3: equ 0x6324.PORT_4: equ 0x6425.PORT_5: equ 0x6526.PORT_6: equ 0x6627.PORT_7: equ 0x6728323940.P1_PATTBL_LAYER_A: equ 0x00000 41.P1_PATTBL_LAYER_B: equ 0X40000 42.P1_SPRATR: equ 0X3fe00 43.P1_NAMTBL_LAYER_A: equ 0X7c000 44.P1_NAMTBL_LAYER_B: equ 0X7e000 46485051.SetRegister:52 out (V9.PORT_4), a 53 ld a, b54 out (V9.PORT_3), a 55 ret5960.SetVdp_Write:61 ld b, a 63 64 xor a 65 di66 out (V9.PORT_4), a68 ld c, V9.PORT_370 71 out (c), e73 74 out (c), d76 77 and 0111 1111 b 78 ei79 out (c), b81 ret8590.LDIRVM:91 92 push bc93 push af94 95 ld a, 0000 0000 B96 out (V9.PORT_4), a98 ld c, V9.PORT_3100 101 out (c), e103 104 out (c), d105 pop af107 108 and 0111 1111 b 109 out (c), a110 pop de112 ld c, V9.PORT_0113.LDIRVM_loop:114 115 outi116 117 dec de118 ld a, e119 or d120 jp nz, .LDIRVM_loop122 ret125128.SetTilePattern:129 ld b, 8130.SetTilePattern_loop:131 push af, bc132 call V9.SetVdp_Write134 ld c, (V9.PORT_0)136 outi outi outi outi 138 ex de, hl139 ld bc, 0x80 140 add hl, bc141 ex de, hl143 pop bc, af144 djnz .SetTilePattern_loop146 ret148150.ClearVRAM:151 xor a152 ld de, 0153 call V9.SetVdp_Write155 156 ld bc, 0 157.ClearVRAM_loop:158 xor a159 160 out (v9.PORT_0), a161 out (v9.PORT_0), a162 out (v9.PORT_0), a163 out (v9.PORT_0), a164 out (v9.PORT_0), a165 out (v9.PORT_0), a166 out (v9.PORT_0), a167 out (v9.PORT_0), a169 dec bc170 ld a, b171 or c172 jp nz, .ClearVRAM_loop174 ret176178.Mode_P1:179 181 182 xor a183 out (V9.PORT_7), a185 189 ld a, 6 190 ld b, 0000 0101 b 191 call V9.SetRegister193 201 ld a, 7 202 ld b, 0000 0000 b 203 call V9.SetRegister206 208 ld a, 8 209 ld b, 1000 0010 b 210 call V9.SetRegister213 214 ld a, 27 215 ld b, 0000 0000 b 216 call V9.SetRegister218 ret221224227 228c:\Users\albs_\source\repos\msx-tests\v9990_p1_test.s12Execute:14 call V9.Mode_P118 19 ld a, 17 20 ld b, 0000 0000 b 21 call V9.SetRegister23 ld a, 18 24 ld b, 0000 0000 b 25 call V9.SetRegister27 ld a, 19 28 ld b, 0000 0000 b 29 call V9.SetRegister31 ld a, 20 32 ld b, 0000 0000 b 33 call V9.SetRegister35 ld a, 21 36 ld b, 0000 0000 b 37 call V9.SetRegister39 ld a, 22 40 ld b, 0000 0000 b 41 call V9.SetRegister43 ld a, 23 44 ld b, 0000 0000 b 45 call V9.SetRegister47 ld a, 24 48 ld b, 0000 0000 b 49 call V9.SetRegister53 call V9.ClearVRAM57 64 ld hl, Tile_Empty 65 ld a, V9.P1_PATTBL_LAYER_A >> 16 66 ld de, V9.P1_PATTBL_LAYER_A AND 0xffff 67 call V9.SetTilePattern69 ld hl, Tile_0 70 ld a, 0 + (V9.P1_PATTBL_LAYER_A + 4) >> 16 71 ld de, 0 + (V9.P1_PATTBL_LAYER_A + 4) AND 0xffff 72 call V9.SetTilePattern74 ld hl, Tile_1 75 ld a, 0 + (V9.P1_PATTBL_LAYER_A + 8) >> 16 76 ld de, 0 + (V9.P1_PATTBL_LAYER_A + 8) AND 0xffff 77 call V9.SetTilePattern81 83 ld hl, Tile_Empty 84 ld a, V9.P1_PATTBL_LAYER_B >> 16 85 ld de, V9.P1_PATTBL_LAYER_B AND 0xffff 86 call V9.SetTilePattern88 ld hl, Tile_0 89 ld a, 0 + (V9.P1_PATTBL_LAYER_B + 4) >> 16 90 ld de, 0 + (V9.P1_PATTBL_LAYER_B + 4) AND 0xffff 91 call V9.SetTilePattern93 ld hl, Tile_1 94 ld a, 0 + (V9.P1_PATTBL_LAYER_B + 8) >> 16 95 ld de, 0 + (V9.P1_PATTBL_LAYER_B + 8) AND 0xffff 96 call V9.SetTilePattern99 100 ld hl, NamesTable_test 101 ld a, V9.P1_NAMTBL_LAYER_A >> 16 102 ld de, V9.P1_NAMTBL_LAYER_A AND 0xffff 103 ld bc, NamesTable_test.size 104 call V9.LDIRVM 106 107 ld hl, NamesTable_B_test 108 ld a, V9.P1_NAMTBL_LAYER_B >> 16 109 ld de, V9.P1_NAMTBL_LAYER_B AND 0xffff 110 ld bc, NamesTable_B_test.size 111 call V9.LDIRVM 115 116 117 121 125 ld a, 13 126 ld b, 0000 01 00 b 127 call V9.SetRegister130 132 133 ld a, 0000 1110 b134 out (V9.PORT_4), a136 137 ld a, 0000 0000 b138 out (V9.PORT_3), a140 143 ld hl, Palette_test_0144 ld c, V9.PORT_1145 ld b, 16 * 3 146 otir150 152 153 ld a, 0000 1110 b154 out (V9.PORT_4), a156 157 ld a, 0100 0000 b158 out (V9.PORT_3), a160 163 ld hl, Palette_test_1164 ld c, V9.PORT_1165 ld b, 16 * 3 166 otir168 169 170 jp $ 173175179183186188198200202204Tile_Empty:205 db 0x00, 0x00, 0x00, 0x00206 db 0x00, 0x00, 0x00, 0x00207 db 0x00, 0x00, 0x00, 0x00208 db 0x00, 0x00, 0x00, 0x00209 db 0x00, 0x00, 0x00, 0x00210 db 0x00, 0x00, 0x00, 0x00211 db 0x00, 0x00, 0x00, 0x00212 db 0x00, 0x00, 0x00, 0x00213.size: equ $ - Tile_Empty215Tile_0:216 db 0x1f, 0xff, 0xff, 0xff217 db 0x20, 0x00, 0x00, 0xff218 db 0x30, 0x00, 0x0f, 0x0f219 db 0x40, 0x00, 0xf0, 0x0f220 db 0x50, 0x0f, 0x00, 0x0f221 db 0x60, 0xf0, 0x00, 0x0f222 db 0x7f, 0x00, 0x00, 0x0f223 db 0x8f, 0xff, 0xff, 0xff224.size: equ $ - Tile_0226Tile_1:227 db 0x00, 0x11, 0x22, 0x33228 db 0x00, 0x11, 0x22, 0x33229 db 0x44, 0x55, 0x66, 0x77230 db 0x44, 0x55, 0x66, 0x77231 db 0x88, 0x99, 0xaa, 0xbb232 db 0x88, 0x99, 0xaa, 0xbb233 db 0xcc, 0xdd, 0xee, 0xff234 db 0xcc, 0xdd, 0xee, 0xff235.size: equ $ - Tile_Empty238NamesTable_test:239 dw 0x0000, 0x0001, 0, 2, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1240 dw 0x0001, 0x0000, 0, 2, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1241.size: equ $ - NamesTable_test243NamesTable_B_test:244 dw 1, 1, 1, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0245 dw 1, 1, 2, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0246 dw 1, 2, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0247.size: equ $ - NamesTable_B_test249Palette_test_0:250 251 db 0, 0, 0252 db 15, 0, 0253 db 15, 31, 31254 db 15, 0, 31256 db 0, 0, 15257 db 31, 0, 0258 db 0, 31, 0259 db 0, 0, 31261 db 31, 15, 15262 db 15, 31, 15263 db 15, 15, 31264 db 15, 0, 0266 db 0, 15, 0267 db 0, 0, 15268 270 db 6, 5, 4271 db 31, 31, 31273Palette_test_1:274 275 db 0, 0, 0276 db 2, 2, 2277 db 4, 4, 4278 db 6, 6, 6280 db 8, 8, 8281 db 10, 10, 10282 db 12, 12, 12283 db 14, 14, 14285 db 16, 16, 16286 db 18, 18, 18287 db 20, 20, 20288 db 22, 22, 22290 db 24, 24, 24291 db 26, 26, 26292 db 28, 28, 28293 db 31, 31, 31296297 ds PageSize - ($ - 0x4000), 255 298