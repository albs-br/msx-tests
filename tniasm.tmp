c:\Users\albs_\source\repos\msx-tests\line-interrupt.s1FNAME "line-interrupt.rom" 3PageSize: equ 0x4000 56 org 0x4000, 0xbeff 8 Include/RomHeader.s12 db "AB" 3 dw Execute 4 dw 0 6 dw 0 8 dw 0 9 dw 0, 0, 0 10 11c:\Users\albs_\source\repos\msx-tests\line-interrupt.s10CHPUT: equ 0x00a2 11CHGMOD: equ 0x005f12WRTVDP: equ 0x004713WRTVRM: equ 0x004d 14NRDVRM: equ 0x0174 15NWRVRM: equ 0x0177 16NSTWRT: equ 0x0171 17BEEP: equ 0x00c018SNSMAT: equ 0x014120PORT_0: equ 0x9821PORT_1: equ 0x9922PORT_2: equ 0x9a23PORT_3: equ 0x9b25REG0SAV: equ 0xF3DF28Execute:30 31 xor a32 ld (Flag_IN), a33 ld (Counter_T), a34 ld (Var_P), a35 ld hl, 036 ld (Var_AD), hl39 40 ld b, 10 41 ld c, 8 42 call WRTVDP 43 44 45 46 ld a, 847 call CHGMOD50 52 53 ld hl, 054 call NSTWRT55 ld c, PORT_057 ld iyl, 058.loop_Y: 59 ld ixl, 060 .loop_X:61 ld a, iyl62 xor ixl63 64 out (c), a65 66 inc hl68 inc ixl69 jp nz, .loop_X70 71 inc iyl72 jp nz, .loop_Y73 75 77 79 di80 81 88 93 96 ld a, 0xc3 97 ld (0xfd9a), a98 ld hl, .line_8099 ld (0xfd9a + 1), hl101 103 105 ld a, (REG0SAV)106 or 16107 ld b, a 108 ld c, 0 109 call WRTVDP 110 di112 114 ld b, 100 115 ld c, 19 116 call WRTVDP 119 121 ei123 129 130.readKeyBoard:131 132 ld a, 8 133 call SNSMAT 134 bit 0, a 135 jp z, .exit 137 jp .readKeyBoard139.exit:140 142 ld a, (REG0SAV)143 and 239144 ld b, a 145 ld c, 0 146 call WRTVDP 148 150 ld a, 201151 ld (-614), a153 155 call BEEP157 ret 159.line_80:161 165 170 ld a, (Flag_IN)171 or a172 jp nz, .else173174 ld a, 1175 ld (Flag_IN), a176 call .sub_470177 xor a178 ld (Flag_IN), a179 ld (Counter_T), a180 ret181.else:182 183 ld hl, Counter_T184 inc (hl)185 186 187 ld a, (hl)188 cp 100189 ret nz191 xor a192 ld (Counter_T), a193 ld (Flag_IN), a194 ret198.sub_470:199 201 ld b, 1202 call RDSTATUSREG203 204 ld a, 1205 and b206 207 cp 1208 209 jp z, .sub_470_line_530210 211 214 ld b, 0 215 ld c, 23 216 call WRTVDP 217 di218 219 ret221.sub_470_line_530:222 226 ld a, (Var_P)227 ld b, a 228 ld c, 23 229 call WRTVDP 230 di231 232 233 ld hl, Var_P234 inc (hl)235 236 ret238241244251RDSTATUSREG:252253 ld a,(0007h) 254 inc a255 ld c,a 257 out (c),b258 ld a,080h+15259 out (c),a260261 262 ld a,(0006h) 263 inc a264 ld c,a 265 in b,(c) 266 267268 ld a,(0007h) 269 inc a270 ld c,a 271 xor a272 out (c),a273 ld a,080h+15274 out (c),a275 277 ret279End:281 db "End ROM started at 0x4000"283 ds PageSize - ($ - 0x4000), 255 286287 org 0xc000289Flag_IN: rb 0290Counter_T: rb 0291Var_P: rb 0292Var_AD: rw 0294 296 297