v9990_p1_test.s1FNAME "v9990_p1_test.rom" 3PageSize: equ 0x4000 56 org 0x4000, 0xbeff 8 Include/RomHeader.s12 db "AB" 3 dw Execute 4 dw 0 6 dw 0 8 dw 0 9 dw 0, 0, 0 10 11v9990_p1_test.s9 Include/V9990.s13V9:5820.PORT_0: equ 0x6021.PORT_1: equ 0x6122.PORT_2: equ 0x6223.PORT_3: equ 0x6324.PORT_4: equ 0x6425.PORT_5: equ 0x6526.PORT_6: equ 0x6627.PORT_7: equ 0x6728323940.P1_PATTBL_LAYER_A: equ 0x00000 41.P1_PATTBL_LAYER_B: equ 0X40000 42.P1_SPRATR: equ 0X3fe00 43.P1_NAMTBL_LAYER_A: equ 0X7c000 44.P1_NAMTBL_LAYER_B: equ 0X7e000 46485051.SetRegister:52 out (V9.PORT_4), a 53 ld a, b54 out (V9.PORT_3), a 55 ret5960.SetVdp_Write:61 ld b, a 63 64 xor a 65 di66 out (V9.PORT_4), a68 ld c, V9.PORT_370 71 out (c), e73 74 out (c), d76 77 and 0111 1111 b 78 ei79 out (c), b81 ret8590.LDIRVM:91 92 push bc93 push af94 95 ld a, 0000 0000 B96 out (V9.PORT_4), a98 ld c, V9.PORT_3100 101 out (c), e103 104 out (c), d105 pop af107 108 and 0111 1111 b 109 out (c), a110 pop de112 ld c, V9.PORT_0113.LDIRVM_loop:114 115 outi116 117 dec de118 ld a, e119 or d120 jp nz, .LDIRVM_loop122 ret125128.SetTilePattern:129 ld b, 8130.SetTilePattern_loop:131 push af, bc132 call V9.SetVdp_Write134 ld c, (V9.PORT_0)136 outi outi outi outi 138 ex de, hl139 ld bc, 0x80 140 add hl, bc141 ex de, hl143 pop bc, af144 djnz .SetTilePattern_loop146 ret148150.ClearVRAM:151 xor a152 ld de, 0153 call V9.SetVdp_Write155 156 ld bc, 0 157.ClearVRAM_loop:158 xor a159 160 out (v9.PORT_0), a161 out (v9.PORT_0), a162 out (v9.PORT_0), a163 out (v9.PORT_0), a164 out (v9.PORT_0), a165 out (v9.PORT_0), a166 out (v9.PORT_0), a167 out (v9.PORT_0), a169 dec bc170 ld a, b171 or c172 jp nz, .ClearVRAM_loop174 ret176178.Mode_P1:179 181 182 xor a183 out (V9.PORT_7), a185 189 ld a, 6 190 ld b, 0000 0101 b 191 call V9.SetRegister193 201 ld a, 7 202 ld b, 0000 0000 b 203 call V9.SetRegister206 208 ld a, 8 209 ld b, 1000 0010 b 210 call V9.SetRegister213 214 ld a, 27 215 ld b, 0000 0000 b 216 call V9.SetRegister218 retv9990_p1_test.s12Execute:14 call V9.Mode_P118 19 ld a, 17 20 ld b, 0000 0000 b 21 call V9.SetRegister23 ld a, 18 24 ld b, 0000 0000 b 25 call V9.SetRegister27 ld a, 19 28 ld b, 0000 0000 b 29 call V9.SetRegister31 ld a, 20 32 ld b, 0000 0000 b 33 call V9.SetRegister35 ld a, 21 36 ld b, 0000 0000 b 37 call V9.SetRegister39 ld a, 22 40 ld b, 0000 0000 b 41 call V9.SetRegister43 ld a, 23 44 ld b, 0000 0000 b 45 call V9.SetRegister47 ld a, 24 48 ld b, 0000 0000 b 49 call V9.SetRegister53 call V9.ClearVRAM57 64 ld hl, Tile_Empty 65 ld a, V9.P1_PATTBL_LAYER_A >> 16 66 ld de, V9.P1_PATTBL_LAYER_A AND 0xffff 67 call V9.SetTilePattern69 ld hl, Tile_0 70 ld a, 0 + (V9.P1_PATTBL_LAYER_A + 4) >> 16 71 ld de, 0 + (V9.P1_PATTBL_LAYER_A + 4) AND 0xffff 72 call V9.SetTilePattern76 78 ld hl, Tile_Empty 79 ld a, V9.P1_PATTBL_LAYER_B >> 16 80 ld de, V9.P1_PATTBL_LAYER_B AND 0xffff 81 call V9.SetTilePattern85 86 ld hl, NamesTable_test 87 ld a, V9.P1_NAMTBL_LAYER_A >> 16 88 ld de, V9.P1_NAMTBL_LAYER_A AND 0xffff 89 ld bc, NamesTable_test.size 90 call V9.LDIRVM 92 93 ld hl, NamesTable_B_test 94 ld a, V9.P1_NAMTBL_LAYER_B >> 16 95 ld de, V9.P1_NAMTBL_LAYER_B AND 0xffff 96 ld bc, NamesTable_B_test.size 97 call V9.LDIRVM 99 100 101 105 109 ld a, 13 110 ld b, 0000 00 00 b 111 call V9.SetRegister114 116 117 ld a, 0000 1110 b118 out (V9.PORT_4), a120 121 ld a, 0000 0000 b122 out (V9.PORT_3), a124 127 ld hl, Palette_test128 ld c, V9.PORT_1129 130 ld b, 16 * 3 131.SetPalette_loop:132 outi 133 outi 134 outi 135 djnz .SetPalette_loop137 138 139 140 jp $ 143145149153156158168170172174Tile_0:175 db 0x1f, 0xff, 0xff, 0xff176 db 0x20, 0x00, 0x00, 0xff177 db 0x30, 0x00, 0x0f, 0x0f178 db 0x40, 0x00, 0xf0, 0x0f179 db 0x50, 0x0f, 0x00, 0x0f180 db 0x60, 0xf0, 0x00, 0x0f181 db 0x7f, 0x00, 0x00, 0x0f182 db 0x8f, 0xff, 0xff, 0xff183.size: equ $ - Tile_0185Tile_Empty:186 db 0x00, 0x00, 0x00, 0x00187 db 0x00, 0x00, 0x00, 0x00188 db 0x00, 0x00, 0x00, 0x00189 db 0x00, 0x00, 0x00, 0x00190 db 0x00, 0x00, 0x00, 0x00191 db 0x00, 0x00, 0x00, 0x00192 db 0x00, 0x00, 0x00, 0x00193 db 0x00, 0x00, 0x00, 0x00194.size: equ $ - Tile_Empty196NamesTable_test:197 dw 0x0000, 0x0001, 0, 1, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1198 dw 0x0001, 0x0000, 0, 1, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1199.size: equ $ - NamesTable_test201NamesTable_B_test:202 dw 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0203.size: equ $ - NamesTable_B_test205Palette_test:206 207 db 15, 0, 0208 db 15, 31, 31209 db 15, 0, 31210 db 15, 15, 15212 db 0, 0, 0213 db 31, 0, 0214 db 0, 31, 0215 db 0, 0, 31217 db 31, 15, 15218 db 15, 31, 15219 db 15, 15, 31220 db 15, 0, 0222 db 0, 15, 0223 db 0, 0, 15224 db 0, 7, 0225 db 0, 0, 7229230 ds PageSize - ($ - 0x4000), 255 231