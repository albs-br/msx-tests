c:\Users\albs_\source\repos\msx-tests\set-palette.s1FNAME "set-palette.rom" 34 org 0x4000, 0xbeff 6 Include/RomHeader.s12 db "AB" 3 dw Execute 4 dw 0 6 dw 0 8 dw 0 9 dw 0, 0, 0 10 11c:\Users\albs_\source\repos\msx-tests\set-palette.s910CHPUT: equ 0x00a211NVBXLN: EQU 0xC912EXTROM: EQU 0x15F13CHGMOD: EQU 0x5F14CHGET: EQU 0x9F15GXPOS: EQU 0xFCB316GYPOS: EQU 0xFCB517ATRBYT: EQU 0xF3F318LOGOPR: EQU 0xFB0219NWRVRM: equ 0x017720WRTVDP: equ 0x004723Execute:24 25 ld a, 526 call CHGMOD28 29 41 42 50 51 52 LD b, 0 53 ld c, 0x09 54 call WRTVDP55 56 58 LD b, 0 59 ld c, 16 60 call WRTVDP61 ld c, 0x9a 62 DI63 ld a, 0x70 64 OUT (C), A65 ld a, 0x00 66 OUT (C), A67 EI68 DI69 ld a, 0x07 70 OUT (C), A71 ld a, 0x00 72 OUT (C), A73 EI74 75 ld hl, PaletteData76 call LoadPalette77 78 79 ld hl, 128*191 80 ld a, 0x87 81 call NWRVRM 82 INC HL83 call NWRVRM 84 85 91 92 call DrawPalette93 94 95 CALL CHGET96 97 xor a98 call CHGMOD99 RET101102LoadPalette:103 104 LD b, 0 105 ld c, 16 106 call WRTVDP107 ld c, 0x9a 109 ld b, 16110LoadPalette.loop:111 DI112 ld a, (hl)113 OUT (C), A114 inc hl115 ld a, (hl)116 OUT (C), A117 EI118 inc hl119 djnz LoadPalette.loop120 121 ret124DrawPalette:125 ld hl, 0126 ld b, 16127 xor a128DrawPalette.loop:129 PUSH HL130 PUSH BC131 push af132 call Draw8x8block133 POP AF134 POP BC135 pop hl136 ld de, 4 137 add hl, de138 ld d, 0x11 139 add a, d140 djnz DrawPalette.loop141 ret144145Draw8x8block:146 ld c, 8147.loop1:148 ld b, 4149.loop:150 call NWRVRM151 inc hl152 djnz .loop153 154 dec c155 ret z156 ld de, 128 - 4157 add hl, de158 jp .loop1159 160 RET162PaletteData:163 164 db 0x00, 0x00 165 db 0x77, 0x00 166 db 0x70, 0x07 167 db 0x70, 0x00 168 db 0x07, 0x00 169 db 0x07, 0x07 170 db 0x00, 0x07 171 db 0x40, 0x00 172 db 0x04, 0x00 173 db 0x00, 0x04 174 db 0x44, 0x00 175 db 0x40, 0x04 176 db 0x77, 0x07 177 db 0x66, 0x06 178 db 0x55, 0x05 179 db 0x44, 0x04 180